<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width">
      <title>SIGHTPATHS_MAIN</title>
      <script src=
         "https://code.jquery.com/jquery-3.5.1.js"></script>
      <style>
         /* (A) SEARCH BOX */
         #AFfilter1 {
         box-sizing: border-box;
         position:absolute;
         top: 15px;
         left: 15px;
         height: 20px;
         width: 164px;
         margin-bottom: 0px;
         padding: 0px;
         }
         #APDD1 option {
         padding: 0px;
         border-bottom: 1px solid #e7e7e7;
         }
         #APDD1 option.hide { display: none; }}
        #AFfilter2 {
         box-sizing: border-box;
         position:absolute;
         top: 15px;
         left: 15px;
         height: 20px;
         width: 164px;
         margin-bottom: 0px;
         padding: 0px;
         }
         #APDD2 option {
         padding: 0px;
         border-bottom: 1px solid #e7e7e7;
         }
         #APDD2 option.hide { display: none; 
         
         nav select{height:600px; width:164px;
         list-style: none;
         padding-left: 0;
         padding-top: 0;}
         nav select{overflow:hidden; overflow-y:scroll;}
        
      </style>
   </head>
   <body>
     <p style="position:absolute;top:640px;text-align:center;left:15px;width:865px;color:#757575;font:13px Helvetica">PLACEHOLDER TEXT DESCRIPTION</p>
     
     
      <canvas id="BorderCanvas"></canvas>
      <script type="text/javascript">
         var canvas = document.getElementById('BorderCanvas');
         if (canvas.getContext) {
           var context = canvas.getContext('2d');
           var xsize = 880;
           var ysize = 1425;
           canvas.style.width = xsize + "px";
           canvas.style.height = ysize + "px";
           // Set actual size in memory (scaled to account for extra pixel density).
           var scale = 1; //window.devicePixelRatio; // Change to 1 on retina screens to see blurry canvas.
           canvas.width = Math.floor(xsize * scale);
           canvas.height = Math.floor(ysize * scale);
           // Normalize coordinate system to use css pixels.
           context.scale(scale, scale);
           context.clearRect(0, 0, canvas.width / scale, canvas.height / scale);
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(0, 0);
           context.lineTo(canvas.width / scale, 0);
           context.strokeStyle = '#00508a';
           context.stroke();
           ////
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(0, 0);
           context.lineTo(0, canvas.height / scale);
           context.stroke();
           ////
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(canvas.width / scale, canvas.height / scale);
           context.lineTo(canvas.width / scale, 0);
           context.stroke();
           ////
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(canvas.width / scale, canvas.height / scale);
           context.lineTo(0, canvas.height / scale);
           context.stroke();
           ////
         }
      </script>
     
     <iframe id="htmlSightpaths_Preview" src="https://aeromidd.github.io/projects/sightpaths/sightpaths_preview.html" title="Preview" style="position:absolute;left:32px;top:5px;height:420px;width:835px;    margin: none;
    padding: none;
    border: none;
    line-height: 0;
    float: left;">
       
     </iframe>
     
      <input type="text" id="AFfilter1" style="position:absolute;left:215px;top:510px;" placeholder="SEARCH AIRPORTS..."/>
      <nav>
         <select id="APDD1" style="position:absolute;left:215px;top:480px;height:25px;width:200px;font:12px Garamond;border: 1px solid #00508a"
                 onChange="//SetAP1Data();"><option value="" disabled selected>Origin</option>
         </select>
      </nav>
      <input type="text" id="AFfilter2" style="position:absolute;left:515px;top:510px;" placeholder="SEARCH AIRPORTS..."/>
      <nav>
         <select id="APDD2" style="position:absolute;left:480px;top:480px;height:25px;width:200px;font:12px Garamond;border: 1px solid #00508a"
                 onChange="//SetAP2Data();"><option value="" disabled selected>Destination</option>
         </select>
      </nav>
     <input type="number" id="InputLat1" name="quantity" min="-89.999" max="90" step=".001" value = "0.000" style="position:absolute;left:220px;top:458px" onChange="drawFoW();">
     <input type="number" id="InputLon1" name="quantity" min="-179.999" max="180" step=".001" value = "0.000" style="position:absolute;left:320px;top:458px" onChange="drawFoW();">
     <input type="number" id="InputLat2" name="quantity" min="-90" max="89.999" step=".001" value = "0.000"  style="position:absolute;left:480px;top:458px" onChange="drawFoW();">
     <input type="number" id="InputLon2" name="quantity" min="-180" max="179.999" step=".001" value = "0.000" style="position:absolute;left:580px;top:458px" onChange="drawFoW();">
     <button id="RandAP1" style="position:absolute;left:220px;top:540px;">Random Airport</button>
     <button id="RandAP2" style="position:absolute;left:560px;top:540px;">Random Airport</button>
      
      <script type="text/javascript">
         console.clear();
        
        
        
        
        let response_promise = fetch("https://aeromidd.github.io/projects/sightpaths/IATAairports.json");
           
           document.addEventListener("DOMContentLoaded", function() {
           response_promise.then(response => response.json().then(AFDATA => {
           //console.log(AFDATA.length)
             
             
             
             var AFNAMES = new Array(AFDATA.length)
              //AFNAMES = AFDATA[AFDATA.length-1].name_full;
             for (i=0;i<AFDATA.length-1;i++){
               AFNAMES[i] = AFDATA[i].name_full;
             }
             
           for (i = 0; i < AFNAMES.length-1; i++) {
             
             var option1 = document.createElement("option");
option1.text = AFNAMES[i];
option1.value = "myvalue";//MAYBE UTILIZE THIS
var select1 = document.getElementById("APDD1");
select1.appendChild(option1);
             
             var option2 = document.createElement("option");
option2.text = AFNAMES[i];
option2.value = "myvalue";//MAYBE UTILIZE THIS
var select2 = document.getElementById("APDD2");
select2.appendChild(option2);
           }
           /////////////////////////
//ORIGIN SEARCH FILTER:
             AFfilter1.oninput = function(event){
         var filter1 = document.getElementById("AFfilter1"), // search box
             //SAFlist1 = document.querySelectorAll("#AFnamelist1 li"); // all list items
             SAFlist1 = document.querySelectorAll("#APDD1 option"); // all list items
             
         // (B) ATTACH KEY UP LISTENER TO SEARCH BOX
         filter1.onkeyup = () => {
           // (B1) GET CURRENT SEARCH TERM
           let search = replaceUmlauts(filter1.value.toLowerCase());
         
           // (B2) LOOP THROUGH LIST ITEMS - ONLY SHOW THOSE THAT MATCH SEARCH
           for (let i of SAFlist1) {
             let item = replaceUmlauts(i.innerHTML.toLowerCase());
             if (item.indexOf(search) == -1) { i.classList.add("hide"); }
             else { i.classList.remove("hide"); }
           }
           //for (let i of SAFlist1){
             //console.log(i)
            //i.selected = 'selected';
           //}
           var selX1 = -1
           for (i = 0; i < SAFlist1.length-1; i++){
            if (SAFlist1[i].classList[0] !=("hide") && selX1 < 0) {
                 selX1 = i;
            }
           }
         
         if (selX1 <= 0){
                  selX1 = 1;
         }
           //console.log(selX1)
SAFlist1[selX1].selected = 'selected';
               //console.log(SAFlist1[selX1].innerHTML)
           SetAP1Data();
         }
        };
             /////////////////////////////
             
//DESTINATION SEARCH FILTER:
             AFfilter2.oninput = function(event){
         var filter2 = document.getElementById("AFfilter2"), // search box
             //SAFlist1 = document.querySelectorAll("#AFnamelist1 li"); // all list items
             SAFlist2 = document.querySelectorAll("#APDD2 option"); // all list items
             
         // (B) ATTACH KEY UP LISTENER TO SEARCH BOX
         filter2.onkeyup = () => {
           // (B1) GET CURRENT SEARCH TERM
           let search = replaceUmlauts(filter2.value.toLowerCase());
         
           // (B2) LOOP THROUGH LIST ITEMS - ONLY SHOW THOSE THAT MATCH SEARCH
           for (let i of SAFlist2) {
             let item = replaceUmlauts(i.innerHTML.toLowerCase());
             if (item.indexOf(search) == -1) { i.classList.add("hide"); }
             else { i.classList.remove("hide"); }
           }
           //for (let i of SAFlist1){
             //console.log(i)
            //i.selected = 'selected';
           //}
           var selX2 = -1
           for (i = 0; i < SAFlist2.length-1; i++){
            if (SAFlist2[i].classList[0] !=("hide") && selX2 < 0) {
                 selX2 = i;
            }
           }
         
         if (selX2 <= 0){
                  selX2 = 1;
         }
           //console.log(selX2)
SAFlist2[selX2].selected = 'selected';
               //console.log(SAFlist2[selX2].innerHTML)
           SetAP2Data();
         }
        };
        
             
             /////////////////////////////

             
             //$w("#htmlFoWmap").postMessage([sendTrips,visibility]);
             
             let fLat1 = 0;
             let fLon1 = 0;
             let fLat2 = 0;
             let fLon2 = 0;
             let fAlt = 30000;
             
	           var sendTrips
             let flight = [];
             flight[0] = [fLat1,fLon1,fLat2,fLon2,fAlt]
             var sendTrip = flight[0];
             sendTrips = [flight[0]];
             
             let visibility = 2;
            
             //document.getElementById('htmlSightpaths_Preview').contentWindow.onReady = function() {
             console.log('testing in a second...')
    setTimeout(function () {
               
        console.log([sendTrips,visibility])
             FoWPreview = document.getElementById('htmlSightpaths_Preview')
             //console.log(FoWPreview)
FoWPreview.contentWindow.postMessage([sendTrips,visibility],FoWPreview.src)
             console.log('finished sending')
             
    }, 10);
//         };    //////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////
        var APDD1Element = document.getElementById('APDD1');
             APDD1Element.onchange = SetAP1Data;
        var APDD2Element = document.getElementById('APDD2');
             APDD2Element.onchange = SetAP2Data;
             
             var RandAP1Element = document.getElementById('RandAP1');
             RandAP1Element.onclick = function(){
               APDD1Element.options[Math.floor(APDD1Element.options.length*Math.random())].selected='selected';SetAP1Data();                                                };
             
             var RandAP2Element = document.getElementById('RandAP2');
             RandAP2Element.onclick = function(){
               APDD2Element.options[Math.floor(APDD2Element.options.length*Math.random())].selected='selected';SetAP2Data();                                                };

             
        function SetAP1Data(){
            var e = document.getElementById("APDD1")
            var ORIGINtext = e.options[e.selectedIndex].text;
             var ORIGIN = AFDATA.filter(function (res) {
  return res.name_full == ORIGINtext;
});
             console.log(ORIGIN[0])
             //then send to coord input boxes. these, upon change, will send to the map.
          document.getElementById("InputLat1").value = parseFloat(ORIGIN[0].latitude_deg.replace("'",''));
 document.getElementById("InputLon1").value = parseFloat(ORIGIN[0].longitude_deg.replace("'",''));
          drawFoW();
        }
             
             
             
        function SetAP2Data(){
            var e = document.getElementById("APDD2")
            var DESTtext = e.options[e.selectedIndex].text;
             var DEST = AFDATA.filter(function (res) {
  return res.name_full == DESTtext;
});
             //console.log(DEST[0].name_full)
             //then send to coord input boxes. these, upon change, will send to the map. 
          document.getElementById("InputLat2").value = parseFloat(DEST[0].latitude_deg.replace("'",''));
 document.getElementById("InputLon2").value = parseFloat(DEST[0].longitude_deg.replace("'",''));
          drawFoW();
        } 
     
     
             
             //END OF APDATA PROMISE
         }))}, false);
           
        function drawFoW(){
             let fLat1 = InputLat1.value;
             let fLon1 = InputLon1.value;
             let fLat2 = InputLat2.value;
             let fLon2 = InputLon2.value;
             let fAlt = 30000;
             
	           var sendTrips
             let flight = [];
             flight[0] = [fLat1,fLon1,fLat2,fLon2,fAlt]
             var sendTrip = flight[0];
             sendTrips = [flight[0]];
             
             let visibility = 2;
            
             //document.getElementById('htmlSightpaths_Preview').contentWindow.onReady = function() {
             console.log('sending flight...')
    setTimeout(function () {
               
        //console.log([sendTrips,visibility])
             FoWPreview = document.getElementById('htmlSightpaths_Preview')
             //console.log(FoWPreview)
FoWPreview.contentWindow.postMessage([sendTrips,visibility],FoWPreview.src)
             console.log('SENT FLIGHT!')
             
    }, 10);
     }
        function replaceUmlauts(str) {
  return str
    .replace(/\u00df/g, 'ss')
    .replace(/\u009a/g, 's')
    .replace(/\u00e0/g, 'a')
    .replace(/\u00e1/g, 'a')
    .replace(/\u00e2/g, 'a')
    .replace(/\u00e3/g, 'a')
    .replace(/\u00e4/g, 'a')
    .replace(/\u00e5/g, 'a')
    .replace(/\u00e6/g, 'ae')
    .replace(/\u00e7/g, 'c')
    .replace(/\u00e8/g, 'e')
    .replace(/\u00e9/g, 'e')
    .replace(/\u00ea/g, 'e')
    .replace(/\u00eb/g, 'e')
    .replace(/\u00ec/g, 'i')
    .replace(/\u00ed/g, 'i')
    .replace(/\u00ee/g, 'i')
    .replace(/\u00ef/g, 'i')
    .replace(/\u00f1/g, 'n')
    .replace(/\u00f2/g, 'o')
    .replace(/\u00f3/g, 'o')
    .replace(/\u00f4/g, 'o')
    .replace(/\u00f5/g, 'o')
    .replace(/\u00f6/g, 'o')
    .replace(/\u00f8/g, 'o')
    .replace(/\u00f9/g, 'u')
    .replace(/\u00fa/g, 'u')
    .replace(/\u00fb/g, 'u')
    .replace(/\u00fc/g, 'u')
    .replace(/\u00fd/g, 'y')
    .replace(/\u00fe/g, 'p')
    .replace(/\u00ff/g, 'y')
    .replace(/\u0000/g, '?')
    .replace(/\u009c/g, 'oe')
    .replace(/\u009e/g, 'z')
    .replace(/\u00f0/g, 'd')
    .replace(/\u0101/g, 'a')
    .replace(/\u0102/g, 'a')
    .replace(/\u0103/g, 'a')
    .replace(/\u0104/g, 'a')
    .replace(/\u0105/g, 'a')
    .replace(/\u0106/g, 'c')
    .replace(/\u0107/g, 'c')
    .replace(/\u0108/g, 'c')
    .replace(/\u0109/g, 'c')
    .replace(/\u010a/g, 'c')
    .replace(/\u010b/g, 'c')
    .replace(/\u010c/g, 'c')
    .replace(/\u010d/g, 'c')
    .replace(/\u010e/g, 'd')
    .replace(/\u010f/g, 'd')
    .replace(/\u0110/g, 'd')
    .replace(/\u0111/g, 'd')
    .replace(/\u0112/g, 'e')
    .replace(/\u0113/g, 'e')
    .replace(/\u0114/g, 'e')
    .replace(/\u0115/g, 'e')
    .replace(/\u0116/g, 'e')
    .replace(/\u0117/g, 'e')
    .replace(/\u0118/g, 'e')
    .replace(/\u0119/g, 'e')
    .replace(/\u011a/g, 'e')
    .replace(/\u011b/g, 'e')
    .replace(/\u011f/g, 'g')
    .replace(/\u0131/g, 'i')
    .replace(/\u0142/g, 'l')
    
          
          
    //.replace(/\u00c4/g, 'A')
    //.replace(/\u00d6/g, 'O')
    //.replace(/\u00dc/g, 'U');
}
        
        
      </script>
   </body>
</html>
