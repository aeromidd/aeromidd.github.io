<!DOCTYPE html>
<html>
   <head>
      <style>
         /*html, body {margin: 0; height: 100%; overflow: hidden}*/
         input[type='number']::-webkit-inner-spin-button,
         input[type='number']::-webkit-outer-spin-button {
         -webkit-appearance: none;
         appearance: none;
         margin: 0;
         }
         .sliderInput {
         -webkit-appearance: none;
         appearance: none;
         position: absolute;
         height: 12px;
         width: 50px;
         border-radius: 5px;
         text-align: center;
         font-family: Courier New, serif;
         font-weight: bold;
         color: #00508a;
         }
         .slider {
         -webkit-appearance: none;
         appearance: none;
         position: absolute;
         width: 200px;
         height: 15px;
         border-radius: 15px;
         background: #d3d3d3;
         outline: none;
         opacity: 0.8;
         -webkit-transition: .2s;
         transition: opacity .2s;
         }
         .slider::-webkit-slider-thumb {
         -webkit-appearance: none;
         appearance: none;
         perspective: 1px;
         width: 20px;
         height: 20px;
         border: 3px solid #00508a;
         border-collapse: separate;
         border-radius: 20px;
         background: #ffffff;
         opacity: 1;
         cursor: grab;
         }
         .slider:hover {
         opacity: 1;
         /* Fully shown on mouse-over */
         background: #189aca;
         cursor: pointer;
         }
      </style>
      <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.4/math.js'></script>
   </head>
   <body>
      <canvas id="BorderCanvas"></canvas>
      <script type="text/javascript">
         var canvas = document.getElementById('BorderCanvas');
         if (canvas.getContext) {
           var context = canvas.getContext('2d');
           var xsize = 880;
           var ysize = 1225;
           canvas.style.width = xsize + "px";
           canvas.style.height = ysize + "px";
           // Set actual size in memory (scaled to account for extra pixel density).
           var scale = 2; //window.devicePixelRatio; // Change to 1 on retina screens to see blurry canvas.
           canvas.width = Math.floor(xsize * scale);
           canvas.height = Math.floor(ysize * scale);
           // Normalize coordinate system to use css pixels.
           context.scale(scale, scale);
           context.clearRect(0, 0, canvas.width / scale, canvas.height / scale);
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(0, 0);
           context.lineTo(canvas.width / scale, 0);
           context.strokeStyle = '#00508a';
           context.stroke();
           ////
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(0, 0);
           context.lineTo(0, canvas.height / scale);
           context.stroke();
           ////
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(canvas.width / scale, canvas.height / scale);
           context.lineTo(canvas.width / scale, 0);
           context.stroke();
           ////
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(canvas.width / scale, canvas.height / scale);
           context.lineTo(0, canvas.height / scale);
           context.stroke();
           ////
         }
      </script>
      <canvas id="TrajCanvas" width="600px" height="600px"
         style="position:absolute;top:20px;left:70px;border: 1px solid #00508a";></canvas>
      <canvas id="LaunchGraphCanvas" width="700px" height="150px"
         style="position:absolute;top:637px;left:70px;border: 1px solid #00508a";>
     </canvas>
      <canvas id="LaunchGraphDateCanvas" width="700px" height="160px"
         style="position:absolute;top:637px;left:70px;border: 1px solid #00508a";>
     </canvas>
     <div class="slidecontainer">
         <form>
            <input id="zoomSlider" class="slider" type="range" name="zoomSlider" min="0" max="900" step="1" value="320" style="display:none;writing-mode: bt-lr; /* IE */
               -webkit-appearance: slider-vertical; /* Chromium */
               width: 8px;
               height: 175px;
               position:absolute;
               top: 50px;
               left: 750px;" oninput="this.form.zoomInput.value=this.value;ZoomChangeFunction(this.value);" />
            <input id="zoomInput" class="sliderInput" type="number" name="zoomInput" style="top:25px;left:700px;" min="1" max="900" value="320" oninput="this.value=Math.min(this.max,Math.max(this.min,this.value));this.form.zoomSlider.value=this.value;ZoomChangeFunction(this.value);"/>
         </form>
      </div>
      <div>
         <button onclick="ZoomIn();" style="position:absolute;top:30px;left:744px;font-family:Courier New">+</button>
         <button onclick="ZoomOut();" style="position:absolute;top:55px;left:744px;font-family:Courier New">-</button>
      </div>
      <div class="slidecontainer">
         <form>
            <input id="dateSlider" class="slider" type="range" name="dateSlider" min="1984" max="9999" step="0.0833333333333333333333" value="0" style="position:absolute;
               top: 620px;
               left: 68px;
               width: 704px;" oninput="this.form.dateInputY.value=Math.floor(this.value);this.form.dateInputM.value=1+Math.round(12*(this.value)%Math.floor(this.value)); DateChangeFunction(this.value);" />
            <input id="dateInputY" class="sliderInput" type="number" name="dateInputY" style="top:640px;left:400px;visibility:hidden" min="1984" max="1" value="0" oninput="this.value=Math.min(this.max,Math.max(this.min,this.value));this.form.dateSlider.value=this.value;DateChangeFunction(this.value);"/>
            <input id="dateInputM" class="sliderInput" type="number" name="dateInputM" style="top:640px;left:450px;visibility:hidden" min="1" max="12" value="13" oninput="this.value=Math.min(this.max,Math.max(this.min,this.value));this.form.dateSlider.value=this.value;DateChangeFunction(this.value);"/>
         </form>
      </div>
      <div>
         <form>
            <label for="cumulativeLaunchesCheck" style=" position:absolute; left:595px; top:600px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> Show Launches Cumulatively </label>
            <input type="checkbox" id="cumulativeLaunchesCheck" checked= true name="cumulativeLaunchescheck" onchange="CumulativeLaunchesChangeFunction();" style=" position:absolute; left:570px; top:598px; filter: hue-rotate(0deg) brightness(1.0) saturate(0%) contrast(2)">
         </form>
      </div>
      <div>
         <form>
            <label for="SLVCheck" style=" position:absolute; left:595px; top:580px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> SLV (Satellite Launch Vehicle)</label>
            <input type="checkbox" id="SLVCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:578px; filter: hue-rotate(0deg) brightness(1.7) saturate(0%)">
         </form>
         <form>
            <label for="SRBMCheck" style=" position:absolute; left:595px; top:560px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> SRBM (Short Range)</label>
            <input type="checkbox" id="SRBMCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:558px; filter: hue-rotate(-60deg) brightness(1.2) saturate(100%)">
         </form>
         <form>
            <label for="MRBMCheck" style=" position:absolute; left:595px; top:540px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> MRBM (Medium Range)</label>
            <input type="checkbox" id="MRBMCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:538px; filter: hue-rotate(-180deg) brightness(1.6) saturate(100%)">
         </form>
         <form>
            <label for="IRBMCheck" style=" position:absolute; left:595px; top:520px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> IRBM (Intermediate Range)</label>
            <input type="checkbox" id="IRBMCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:518px; filter: hue-rotate(-225deg) brightness(1.0) contrast(1.5) saturate(100%)">
         </form>
         <form>
            <label for="ICBMCheck" style=" position:absolute; left:595px; top:500px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> ICBM (Inter-Continental)</label>
            <input type="checkbox" id="ICBMCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:498px; filter: hue-rotate(-270deg) brightness(1.0) contrast(2) saturate(66%)">
         </form>
         <form>
            <label for="HypRangeCheck" style=" position:absolute; left:595px; top:480px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> Show Hypothetical Ranges*</label>
            <input type="checkbox" id="HypRangeCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:478px; filter: hue-rotate(-270deg) brightness(1.0) contrast(5) saturate(0%)">
         </form>
      </div>
      <div style="position:absolute;top:20px;left:779px;font-family: Garamond, serif; font-size: 15px; color: #252525;">
         Show Continents:
      </div>
      <div>
         <form>
            <label for="SelectAllContinents" style=" position:absolute; left:795px; top:40px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Select All</label>
            <input type="checkbox" id="SelectAllContinents" checked= false onchange="SelectAllContinentsFnc();" style=" position:absolute; left:775px; top:38px;">
         </form>
         <form>
            <label for="Asia" style=" position:absolute; left:795px; top:60px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Asia</label>
            <input type="checkbox" id="Asia" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:58px;">
         </form>
         <form>
            <label for="NorthAmerica" style=" position:absolute; left:795px; top:80px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">North America</label>
            <input type="checkbox" id="NorthAmerica" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:78px;">
         </form>
         <form>
            <label for="Europe" style=" position:absolute; left:795px; top:100px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Europe</label>
            <input type="checkbox" id="Europe" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:98px;">
         </form>
         <form>
            <label for="Oceania" style=" position:absolute; left:795px; top:120px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Oceania</label>
            <input type="checkbox" id="Oceania" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:118px;">
         </form>
         <form>
            <label for="Africa" style=" position:absolute; left:795px; top:140px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Africa</label>
            <input type="checkbox" id="Africa" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:138px;">
         </form>
         <form>
            <label for="SouthAmerica" style=" position:absolute; left:795px; top:160px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">South America</label>
            <input type="checkbox" id="SouthAmerica" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:158px;">
         </form>
         <form>
            <label for="Antarctica" style=" position:absolute; left:795px; top:180px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Antarctica</label>
            <input type="checkbox" id="Antarctica" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:178px;">
         </form>
      </div>
      <div style="position:absolute;top:200px;left:779px;font-family: Garamond, serif; font-size: 15px; color: #252525;">
         Show Countries:
      </div>
      <div>
         <form>
            <label for="SelectAllCountries" style=" position:absolute; left:795px; top:220px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Select All</label>
            <input type="checkbox" id="SelectAllCountries" checked= false onchange="SelectAllCountriesFnc();" style=" position:absolute; left:775px; top:218px;">
         </form>
         <form>
            <label for="Korea" style=" position:absolute; left:795px; top:240px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Korea</label>
            <input type="checkbox" id="Korea" checked= true disabled=true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:238px;">
         </form>
         <form>
            <label for="Japan" style=" position:absolute; left:795px; top:260px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Japan</label>
            <input type="checkbox" id="Japan" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:258px;">
         </form>
         <form>
            <label for="China" style=" position:absolute; left:795px; top:280px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">China</label>
            <input type="checkbox" id="China" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:278px;">
         </form>
         <form>
            <label for="Russia" style=" position:absolute; left:795px; top:300px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Russia</label>
            <input type="checkbox" id="Russia" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:298px;">
         </form>
         <form>
            <label for="Guam" style=" position:absolute; left:795px; top:320px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Guam</label>
            <input type="checkbox" id="Guam" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:318px;">
         </form>
         <form>
            <label for="Alaska" style=" position:absolute; left:795px; top:340px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Alaska</label>
            <input type="checkbox" id="Alaska" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:338px;">
         </form>
         <form>
            <label for="Canada" style=" position:absolute; left:795px; top:360px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Canada</label>
            <input type="checkbox" id="Canada" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:358px;">
         </form>
         <form>
            <label for="Hawaii" style=" position:absolute; left:795px; top:380px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Hawaii</label>
            <input type="checkbox" id="Hawaii" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:378px;">
         </form>
         <form>
            <label for="USAC" style=" position:absolute; left:795px; top:400px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">US contiguous</label>
            <input type="checkbox" id="USAC" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:398px;">
         </form>
         <form>
            <label for="India" style=" position:absolute; left:795px; top:420px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">India</label>
            <input type="checkbox" id="India" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:418px;">
         </form>
         <form>
            <label for="Germany" style=" position:absolute; left:795px; top:440px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Germany</label>
            <input type="checkbox" id="Germany" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:438px;">
         </form>
         <form>
            <label for="UK" style=" position:absolute; left:795px; top:460px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">UK</label>
            <input type="checkbox" id="UK" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:458px;">
         </form>
         <form>
            <label for="France" style=" position:absolute; left:795px; top:480px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">France</label>
            <input type="checkbox" id="France" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:478px;">
         </form>
         <form>
            <label for="Australia" style=" position:absolute; left:795px; top:500px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Australia</label>
            <input type="checkbox" id="Australia" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:498px;">
         </form>
         <form>
            <label for="Nigeria" style=" position:absolute; left:795px; top:520px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Nigeria</label>
            <input type="checkbox" id="Nigeria" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:518px;">
         </form>
         <form>
            <label for="SouthAfrica" style=" position:absolute; left:795px; top:540px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">South Africa</label>
            <input type="checkbox" id="SouthAfrica" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:538px;">
         </form>
         <form>
            <label for="Brazil" style=" position:absolute; left:795px; top:560px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Brazil</label>
            <input type="checkbox" id="Brazil" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:558px;">
         </form>
      </div>
     <p style=" position:absolute; left:70px; top:800px; width:700px; font-family: Helvetica; font-size: 13px; color: grey;text-align:justify"> This data visualisation represents the State of North Korea’s missile launch trajectories since 1984, directly <b>to scale</b> relative to their range proximity to other countries and territories, the Earth’s circumference, and various orbital altitudes. <br>I started developing this graphic after becoming frustrated that news reports often reported the missile trajectory’s altitude and distance reached in raw numbers, but with no context or intuitive/visual communication of literally how high or how far these weaponisable vehicles flew.
<br>
       <br>
The ranges of the trajectories are visualised against a 2D representation of the Earth, showing how high and far they travel relative to the Earth’s diameter, circumference, and the height of its atmosphere (the little light blue line close to the surface - most of these missiles flew into Low Earth Orbit and several even higher than the International Space Station!). At the same time, the 2D Earth depiction is populated with radial points and slices representing different countries, population centres, territories, and continents, in a <i>“circle of equivalent ranges”</i>: arranged by shortest <a href="https://en.wikipedia.org/wiki/Great-circle_distance">Great Circle distances</a> from the approximate geographical centre of North Korea - hence some entity overlaps because latitude and longitude have been collapsed into Great Circle range equivalents.
<br>
       <br>

       Crucially, these are <b>equivalent</b> ranges: missile path endpoints show range proximity to the displayed geographical entities, <u>not actual impact locations</u>. For example, the missile travelling 3,700km in September 2017 reached an <i>equivalent</i> distance to Guam, despite actually splashing down in the Pacific thousands of km to the North-East, presenting no physical threat to Guam - but presumably demonstrating the capability.
<br>
       <br>

All geometry and distances in this diagram are to scale. Each missile path depicted is assumed as a 2nd order parabola for the purposes of this visualisation, calculated from available missile spec, apogee and ground distance data provided by the <a href="https://www.nti.org/analysis/articles/cns-north-korea-missile-test-database/">CNS North Korea Missile Test Database via the Nuclear Threat Initiative (NTI)</a>.
<br>
       <br>

*<i>”Hypothetical Range” refers to trajectories which have been conducted in a “lofted” configuration, converted to an equivalent conventional strike trajectory (only if such an estimate has been given by official sources of either NK or organizations/countries which monitor their launches). These estimated conventional ranges, if available, are depicted if the “Show Hypothetical Ranges” checkbox is selected.</i></p>
     <script type="text/javascript">
  const trajCanvas = document.getElementById("TrajCanvas");

  trajCanvas.addEventListener("wheel", function (e) {
    e.preventDefault(); // prevent page scrolling

    const step = 5; // zoom step per wheel notch
    const direction = Math.sign(e.deltaY); // +1 = down, -1 = up

    let current = Number(zoomInput.value);
    let newValue = current - direction * step;

    // clamp to allowed range
    newValue = Math.min(zoomInput.max, Math.max(zoomInput.min, newValue));

    zoomInput.value = newValue;
    zoomSlider.value = newValue;

    ZoomChangeFunction(newValue);
  }, { passive: false });
</script>
      <script type="text/javascript">
         console.clear();
         
         //update the date
         var today = new Date();
         var dd = String(today.getDate()).padStart(2, '0');
         var mm = Number(String(today.getMonth() + 1).padStart(2, '0'));   //January is 0!
         var yyyy = today.getFullYear();
         
         //comment out the following to instead use today's date as the default end/latest.  
         //*
         dd = 4;
         mm = 12;
         yyyy = 2024;
         //*/
        
         //console.log(today)
         //console.log(mm)
         //console.log(yyyy)
         dateInputM.value = mm;
         dateInputM.max = mm;
         dateInputY.value = yyyy;
         dateInputY.max = yyyy;
         dateSlider.value = yyyy+(mm)/12;
         dateSlider.max = yyyy+(mm)/12;
         //console.log(mm)
         HypRangeCheck.checked = false;
         
         //Initial Conditions
         SelectAllContinents.checked = false;
         Asia.checked = true;
         NorthAmerica.checked = true;
         Europe.checked = true;
         Oceania.checked = false;
         Africa.checked = true;
         SouthAmerica.checked = true;
         Antarctica.checked = false;
         
         
         function SelectAllContinentsFnc(){
           var continentssetting
           if (SelectAllContinents.checked == true){
             continentssetting = true;
           }else{
             continentssetting = false;
           }
         
               Asia.checked = continentssetting;
               NorthAmerica.checked = continentssetting;
               Europe.checked = continentssetting;
               Oceania.checked = continentssetting;
               Africa.checked = continentssetting;
               SouthAmerica.checked = continentssetting;
               Antarctica.checked = continentssetting;
         
           DrawTrajectories();
         }
         
         //Initial Conditions
         SelectAllCountries.checked = false;
         Japan.checked = true;
         China.checked = false;
         Russia.checked = false;
         Guam.checked = true;
         Alaska.checked = true;
         Canada.checked = false;
         Hawaii.checked = true;
         USAC.checked = true;
         India.checked = true;
         Germany.checked = false;
         UK.checked = true;
         France.checked = false;
         Australia.checked = false;
         Nigeria.checked = true;
         SouthAfrica.checked = false;
         Brazil.checked = true;
         
         function SelectAllCountriesFnc(){
           var countriessetting
           if (SelectAllCountries.checked == true){
             countriessetting = true;
           }else{
             countriessetting = false;
           }
         
               Japan.checked = countriessetting;
               China.checked = countriessetting;
               Russia.checked = countriessetting;
               Guam.checked = countriessetting;
               Alaska.checked = countriessetting;
               Canada.checked = countriessetting;
               Hawaii.checked = countriessetting;
               USAC.checked = countriessetting;
               India.checked = countriessetting;
               Germany.checked = countriessetting;
               UK.checked = countriessetting;
               France.checked = countriessetting;
               Australia.checked = countriessetting;
               Nigeria.checked = countriessetting;
               SouthAfrica.checked = countriessetting;
               Brazil.checked = countriessetting;
         
           DrawTrajectories();
         }
         
         let zoomPts = [0,4,20,50,100,180,320,470,575,675,775,900];
         
         function ZoomIn(){
           if (Number(zoomSlider.value) < math.max(zoomPts)){
               var current = Number(zoomSlider.value);
               var nextval = zoomPts.find(element => {return element > current;});
               //console.log(nextval)
               var idx = zoomPts.indexOf(nextval);
               
               zoomSlider.value = zoomPts[idx];
               zoomInput.value = zoomPts[idx];
               DrawTrajectories();
           }
         }
         
         function ZoomOut(){
           if (Number(zoomSlider.value) > math.min(zoomPts)){
               var current = Number(zoomSlider.value);
               var nextval = zoomPts.reverse().find(element => {return element < current;});
               //console.log(nextval)
               var idx = zoomPts.reverse().indexOf(nextval);
                 zoomSlider.value = zoomPts[idx];
                 zoomInput.value = zoomPts[idx];
               DrawTrajectories();
           }
         }
         
         //%launchdata
         //%SUCCESSFUL LAUNCHES ONLY?
         
         //%type guide: 0 - SLV, 1 - SRBM, 2 - MRBM, 3 - IRBM, 4 - ICBM
         //%               grey?    green?     orange?   red?     purple?
         //All distances in km
         //%[apogee, arc dist, type, predict?, year, month, day, no. of missiles]
        let launchdata = [
          [0,0,1,0,1984,4,9,1,3,NaN,],[0,0,1,0,1984,4,9,1,4,NaN,],[200,0,1,0,1984,4,9,1,5,NaN,],[0,0,1,0,1984,9,1,0,6,NaN,],[200,0,1,0,1984,9,1,0,7,NaN,],[200,0,1,0,1984,9,1,0,8,NaN,],[200,0,1,0,1990,6,1,1,11,NaN,],[0,0,1,0,1991,7,1,1,12,NaN,],[150,500,2,0,1993,5,29,1,14,NaN,],[200,0,1,0,1993,5,29,0,15,NaN,],[200,0,1,0,1993,5,29,1,16,NaN,],[200,0,1,0,1993,5,30,1,17,NaN,],[0,1380,0,0,1998,8,31,0,18,NaN,],[40,0,0,0,2006,7,5,0,19,NaN,],[150,0,1,0,2006,7,5,1,20,NaN,],[150,0,2,0,2006,7,5,1,21,NaN,],[150,0,1,0,2006,7,5,1,22,NaN,],[150,0,2,0,2006,7,5,1,23,NaN,],[150,0,2,0,2006,7,5,1,24,NaN,],[150,0,2,0,2006,7,5,1,25,NaN,],[0,0,0,0,2009,4,5,0,26,NaN,],[150,0,2,0,2009,7,5,1,27,NaN,],[150,0,2,0,2009,7,5,1,28,NaN,],[0,0,1,0,2009,7,5,1,29,NaN,],[0,0,1,0,2009,7,5,1,30,NaN,],[0,0,1,0,2009,7,5,1,31,NaN,],[0,0,1,0,2009,7,5,1,32,NaN,],[0,0,1,0,2009,7,5,1,33,NaN,],[0,0,0,0,2012,4,13,0,34,NaN,],[581,0,0,0,2012,12,12,1,35,NaN,],[80,200,1,0,2014,2,27,1,42,NaN,],[0,200,1,0,2014,2,27,1,43,NaN,],[0,200,1,0,2014,2,27,1,44,NaN,],[0,200,1,0,2014,2,27,1,45,NaN,],[150,500,1,0,2014,3,3,1,46,NaN,],[0,500,1,0,2014,3,3,1,47,NaN,],[150,650,2,0,2014,3,26,1,48,NaN,],[150,650,2,0,2014,3,26,1,49,NaN,],[0,0,1,0,2014,6,26,1,50,NaN,],[150,0,1,0,2014,6,29,1,51,NaN,],[150,0,1,0,2014,6,29,1,52,NaN,],[100,500,1,0,2014,7,9,1,53,NaN,],[100,500,1,0,2014,7,9,1,54,NaN,],[120,500,1,0,2014,7,13,1,55,NaN,],[120,500,1,0,2014,7,13,1,56,NaN,],[0,500,1,0,2014,7,26,1,57,NaN,],[0,0,1,0,2014,8,14,1,58,NaN,],[0,0,1,0,2014,9,1,1,59,NaN,],[0,0,1,0,2014,9,6,1,60,NaN,],[0,0,1,0,2015,2,8,1,61,NaN,],[0,0,1,0,2015,2,8,1,62,NaN,],[0,0,1,0,2015,2,8,1,63,NaN,],[0,0,1,0,2015,2,8,1,64,NaN,],[0,0,1,0,2015,2,8,1,65,NaN,],[134,490,1,0,2015,3,1,1,66,NaN,],[134,490,1,0,2015,3,1,1,67,NaN,],[0,0,1,0,2015,4,2,1,68,NaN,],[0,0,1,0,2015,4,3,1,69,NaN,],[0,0,1,0,2015,4,3,1,70,NaN,],[0,0,1,0,2015,4,3,1,71,NaN,],[0,0,1,0,2015,4,3,1,72,NaN,],[0,0,1,0,2015,5,8,1,73,NaN,],[0,0,1,0,2015,11,28,0,74,NaN,],[0,0,1,0,2015,12,21,0,75,NaN,],[502,0,0,0,2016,2,7,1,76,NaN,],[0,0,1,0,2016,3,10,1,77,NaN,],[0,0,1,0,2016,3,10,1,78,NaN,],[0,800,2,0,2016,3,18,1,79,NaN,],[17,0,2,0,2016,3,18,0,80,NaN,],[0,0,3,0,2016,4,15,0,81,NaN,],[0,30,1,0,2016,4,23,1,82,NaN,],[0,0,3,0,2016,4,27,0,83,NaN,],[0,0,3,0,2016,4,28,0,84,NaN,],[0,0,3,0,2016,5,30,0,85,NaN,],[0,0,3,0,2016,6,21,0,86,1000,],[1400,400,3,0,2016,6,21,1,87,1000,],[10,0,1,0,2016,7,9,0,88,NaN,],[0,0,1,0,2016,7,18,1,89,NaN,],[0,0,1,0,2016,7,18,1,90,NaN,],[0,500,2,0,2016,7,18,1,91,NaN,],[0,1000,2,0,2016,8,2,1,92,NaN,],[0,0,2,0,2016,8,2,0,93,NaN,],[0,500,1,0,2016,8,23,1,94,1200,],[0,1000,2,0,2016,9,5,1,95,NaN,],[0,1000,2,0,2016,9,5,1,96,NaN,],[0,1000,2,0,2016,9,5,1,97,NaN,],[0,0,3,0,2016,10,14,0,98,NaN,],[0,0,3,0,2016,10,19,0,99,NaN,],[550,500,2,0,2017,2,11,1,100,NaN,],[260,1000,2,0,2017,3,5,1,101,NaN,],[260,1000,2,0,2017,3,5,1,102,NaN,],[260,1000,2,0,2017,3,5,1,103,NaN,],[260,1000,2,0,2017,3,5,1,104,NaN,],[0,0,2,0,2017,3,5,0,105,NaN,],[189,60,3,0,2017,4,4,0,107,NaN,],[0,0,3,0,2017,4,15,0,108,NaN,],[71,0,3,0,2017,4,28,0,109,NaN,],[2111.5,787,3,0,2017,5,14,1,110,3800,],[560,500,2,0,2017,5,21,1,111,NaN,],[120,400,1,0,2017,5,28,1,112,NaN,],[2802,933,4,0,2017,7,4,1,113,10000,],[3724.9,998,4,0,2017,7,28,1,114,11000,],[0,250,1,0,2017,8,25,1,115,NaN,],[0,0,1,0,2017,8,25,0,116,NaN,],[0,250,1,0,2017,8,25,1,117,NaN,],[550,2700,3,0,2017,8,28,0,118,4500,],[770,3700,3,0,2017,9,14,1,119,NaN,],[4475,950,4,0,2017,11,28,1,120,13000,],[0,0,1,0,2019,4,17,1,121,NaN,],[0,200,1,0,2019,5,4,1,122,NaN,],[0,0,1,0,2019,5,4,1,123,NaN,],[50,420,1,0,2019,5,9,1,124,NaN,],[0,0,1,0,2019,5,9,1,125,NaN,],[50,430,1,0,2019,7,24,1,126,NaN,],[50,690,1,0,2019,7,24,1,127,NaN,],[25,220,1,0,2019,8,1,1,130,NaN,],[25,220,1,0,2019,8,1,1,131,NaN,],[37,450,1,0,2019,8,5,1,132,NaN,],[37,450,1,0,2019,8,5,1,133,NaN,],[48,400,1,0,2019,8,9,1,134,NaN,],[48,400,1,0,2019,8,9,1,135,NaN,],[30,230,1,0,2019,8,15,1,136,NaN,],[30,230,1,0,2019,8,15,1,137,NaN,],[97,380,1,0,2019,8,23,1,138,NaN,],[97,380,1,0,2019,8,23,1,139,NaN,],[50,330,1,0,2019,9,9,1,140,NaN,],[50,330,1,0,2019,9,9,1,141,NaN,],[0,0,1,0,2019,9,9,0,142,NaN,],[910,450,1,0,2019,10,1,1,143,1900,],[90,370,1,0,2019,10,31,1,144,NaN,],[90,370,1,0,2019,10,31,1,145,NaN,],[97,380,1,0,2019,11,28,1,146,NaN,],[97,380,1,0,2019,11,28,1,147,NaN,],[35,240,1,0,2020,3,2,1,148,NaN,],[35,240,1,0,2020,3,2,1,149,NaN,],[50,200,1,0,2020,3,8,1,150,NaN,],[50,200,1,0,2020,3,8,1,151,NaN,],[50,200,1,0,2020,3,8,1,152,NaN,],[50,410,1,0,2020,3,20,1,153,NaN,],[50,410,1,0,2020,3,20,1,154,NaN,],[30,230,1,0,2020,3,28,1,155,NaN,],[30,230,1,0,2020,3,28,1,156,NaN,],[60,450,1,0,2021,3,24,1,157,NaN,],[60,450,1,0,2021,3,24,1,158,NaN,],[60,800,1,0,2021,9,15,1,159,NaN,],[60,800,1,0,2021,9,15,1,160,NaN,],[60,200,3,0,2021,9,27,1,161,NaN,],[60,590,1,0,2021,10,19,1,162,NaN,],[30,700,2,0,2022,1,5,1,163,NaN,],[60,1000,2,0,2022,1,10,1,164,NaN,],[36,430,1,0,2022,1,14,1,165,NaN,],[36,430,1,0,2022,1,14,1,166,NaN,],[42,380,1,0,2022,1,16,1,167,NaN,],[42,380,1,0,2022,1,16,1,168,NaN,],[20,190,1,0,2022,1,26,1,169,NaN,],[20,190,1,0,2022,1,26,1,170,NaN,],[2000,800,3,0,2022,1,29,1,171,NaN,],[0,0,4,0,2022,3,16,0,174,NaN,],[6248,1090,4,0,2022,3,24,1,175,14500,],[25,110,1,0,2022,4,16,1,176,NaN,],[25,110,1,0,2022,4,16,1,177,NaN,],[780,470,4,0,2022,5,4,0,178,NaN,],[60,600,1,0,2022,5,7,0,179,NaN,],[90,360,1,0,2022,5,12,0,180,NaN,],[90,360,1,0,2022,5,12,0,181,NaN,],[90,360,1,0,2022,5,12,0,182,NaN,],[60,760,1,0,2022,5,24,1,185,NaN,],[50,350,1,0,2022,6,5,0,186,NaN,],[50,300,1,0,2022,6,5,0,187,NaN,],[50,400,1,0,2022,6,5,0,188,NaN,],[90,670,1,0,2022,6,5,0,189,NaN,],[100,350,1,0,2022,6,5,0,190,NaN,],[50,400,1,0,2022,6,5,0,191,NaN,],[90,670,1,0,2022,6,5,0,192,NaN,],[100,300,1,0,2022,6,5,0,193,NaN,],[60,600,1,0,2022,9,24,1,194,NaN,],[50,350,1,0,2022,9,28,1,195,NaN,],[50,300,1,0,2022,9,28,1,196,NaN,],[50,350,1,0,2022,9,29,1,197,NaN,],[50,300,1,0,2022,9,29,1,198,NaN,],[50,400,1,0,2022,9,30,1,199,NaN,],[50,350,1,0,2022,9,30,1,200,NaN,],[970,4500,3,0,2022,10,3,1,201,NaN,],[100,350,1,0,2022,10,5,1,202,NaN,],[50,800,1,0,2022,10,5,1,203,NaN,],[90,350,1,0,2022,10,8,1,204,NaN,],[90,350,1,0,2022,10,8,1,205,NaN,],[50,700,1,0,2022,10,13,0,206,NaN,],[24,230,1,0,2022,10,28,0,207,NaN,],[24,230,1,0,2022,10,28,0,208,NaN,],[0,0,1,0,2022,11,1,1,209,NaN,],[0,0,1,0,2022,11,1,1,210,NaN,],[0,0,1,0,2022,11,1,1,211,NaN,],[0,0,1,0,2022,11,1,1,212,NaN,],[100,200,1,0,2022,11,1,0,213,NaN,],[150,150,1,0,2022,11,1,0,214,NaN,],[150,150,1,0,2022,11,1,0,215,NaN,],[1920,760,4,0,2022,11,2,0,216,NaN,],[70,330,1,0,2022,11,2,1,217,NaN,],[70,330,1,0,2022,11,2,1,218,NaN,],[130,490,1,0,2022,11,3,1,219,NaN,],[130,490,1,0,2022,11,3,1,220,NaN,],[130,490,1,0,2022,11,3,1,221,NaN,],[30,290,1,0,2022,11,9,0,222,NaN,],[47,240,1,0,2022,11,17,0,223,NaN,],[6100,1000,4,0,2022,11,18,1,224,14500,],[550,500,2,0,2022,12,18,1,225,NaN,],[550,500,2,0,2022,12,18,1,226,NaN,],[0,250,1,0,2022,12,23,0,227,NaN,],[50,350,1,0,2022,12,23,0,228,NaN,],[100,350,1,0,2022,12,30,1,229,NaN,],[100,350,1,0,2022,12,30,1,230,NaN,],[100,350,1,0,2022,12,30,1,231,NaN,],[5700,900,4,0,2023,2,18,1,232,NaN,],[100,400,1,0,2023,2,19,1,233,NaN,],[50,350,1,0,2023,2,19,1,234,NaN,],[0,0,1,0,2023,3,9,1,235,NaN,],[0,0,1,0,2023,3,9,1,236,NaN,],[0,0,1,0,2023,3,9,1,237,NaN,],[0,0,1,0,2023,3,9,1,238,NaN,],[0,0,1,0,2023,3,9,1,239,NaN,],[0,0,1,0,2023,3,9,1,240,NaN,],[0,620,1,0,2023,3,13,1,241,NaN,],[0,620,1,0,2023,3,13,1,242,NaN,],[6000,1000,4,0,2023,3,15,1,243,13500,],[50,800,1,0,2023,3,19,1,244,NaN,],[50,350,1,0,2023,3,26,1,245,NaN,],[50,350,1,0,2023,3,26,1,246,NaN,],[0,1000,4,0,2023,4,12,1,247,NaN,],[0,0,0,0,2023,5,30,0,248,NaN,],[50,850,1,0,2023,6,15,0,249,NaN,],[50,900,1,0,2023,6,15,0,250,NaN,],[6648,1101,4,0,2023,7,12,1,251,12000,],[50,550,1,0,2023,7,18,0,252,NaN,],[50,600,1,0,2023,7,18,0,253,NaN,],[100,350,1,0,2023,7,24,0,254,NaN,],[100,400,1,0,2023,7,24,0,255,NaN,],[0,0,0,0,2023,8,23,0,256,NaN,],[50,350,1,0,2023,8,30,1,257,NaN,],[50,400,1,0,2023,8,30,1,258,NaN,],[50,350,1,0,2023,9,13,0,259,NaN,],[50,650,1,0,2023,9,13,0,260,NaN,],[0,0,0,0,2023,11,22,1,261,NaN,],[50,570,1,0,2023,12,17,0,263,NaN,],[6518,1002,4,0,2023,12,17,1,264,NaN,],[50,1000,3,0,2024,1,14,1,265,NaN,],[50,350,1,0,2024,3,17,1,266,NaN,],[50,350,1,0,2024,3,17,1,267,NaN,],[50,350,1,0,2024,3,17,1,268,NaN,],[50,350,1,0,2024,3,17,1,269,NaN,],[50,350,1,0,2024,3,17,1,270,NaN,],[50,350,1,0,2024,3,17,1,271,NaN,],[101,1000,3,0,2024,4,1,1,272,NaN,],[50,250,1,0,2024,4,22,1,273,NaN,],[50,250,1,0,2024,4,22,1,274,NaN,],[50,250,1,0,2024,4,22,1,275,NaN,],[50,250,1,0,2024,4,22,1,276,NaN,],[0,0,0,0,2024,5,27,0,277,NaN,],[100,350,1,0,2024,5,29,1,278,NaN,],[100,350,1,0,2024,5,29,1,279,NaN,],[100,350,1,0,2024,5,29,1,280,NaN,],[100,350,1,0,2024,5,29,1,281,NaN,],[100,350,1,0,2024,5,29,1,282,NaN,],[100,350,1,0,2024,5,29,1,283,NaN,],[100,350,1,0,2024,5,29,1,284,NaN,],[100,350,1,0,2024,5,29,1,285,NaN,],[100,350,1,0,2024,5,29,1,286,NaN,],[100,350,1,0,2024,5,29,1,287,NaN,],[100,350,1,0,2024,5,29,1,288,NaN,],[100,350,1,0,2024,5,29,1,289,NaN,],[100,350,1,0,2024,5,29,1,290,NaN,],[100,350,1,0,2024,5,29,1,291,NaN,],[100,350,1,0,2024,5,29,1,292,NaN,],[100,350,1,0,2024,5,29,1,293,NaN,],[100,350,1,0,2024,5,29,1,294,NaN,],[100,350,1,0,2024,5,29,1,295,NaN,],[0,600,1,0,2024,6,30,1,297,NaN,],[100,350,1,0,2024,9,11,1,299,NaN,],[100,350,1,0,2024,9,11,1,300,NaN,],[100,350,1,0,2024,9,11,1,301,NaN,],[0,400,1,0,2024,9,18,1,302,NaN,],[0,400,1,0,2024,9,18,1,303,NaN,],[7687,1001,4,0,2024,10,30,1,304,15000,],[100,400,1,0,2024,11,4,0,305,NaN,],
          ];
         //%[apogee, arc dist, type, predict?, year, month, day, success/fail/unknown, excelID]
         //console.log(launchdata.length)
         //%check for unknown apogee/distancetravelled (0)
         var knClean = 0;
         var knCorrections = 0;  
         
         for (i = 0; i < launchdata.length; i++) {//launchdata.length
         //for i = 1:1:length(launchdata)
         if (launchdata[i][0] == 0 && launchdata[i][1] == 0){
             launchdata[i][0] = 30+25*Math.random();
             launchdata[i][1] = 50+50*Math.random();
             knCorrections = knCorrections + 1;
         }else if (launchdata[i][0] == 0 || launchdata[i][1] == 0){
             if (launchdata[i][0] == 0){
                 launchdata[i][0] = 0.25*launchdata[i][1]+(0.5*Math.random()-0.25)*launchdata[i][0];
             }else{
                 launchdata[i][1] = launchdata[i][0]+(0.25*Math.random()-1/8)*launchdata[i][0];
             }
             knCorrections = knCorrections + 1;
         }else{
             knClean = knClean + 1;
         }
         }
         
         //CumulativeLaunchesGraph
         SetupLaunchesGraph(launchdata);
         SetupLaunchDateGraph();
        
        
        
        function SetupLaunchDateGraph(){
          var canvas = document.getElementById('LaunchGraphDateCanvas');
         var context = canvas.getContext('2d');
         
         var xsize = 700;
         var ysize = 160;
         canvas.style.width = xsize + "px";
         canvas.style.height = ysize + "px";
         
         // Set actual size in memory (scaled to account for extra pixel density).
         var scale = 4;//window.devicePixelRatio; // Change to 1 on retina screens to see blurry canvas.
         canvas.width = Math.floor(xsize * scale);
         canvas.height = Math.floor(ysize * scale);
         
         // Normalize coordinate system to use css pixels.
         context.scale(scale, scale);
         
         context.clearRect(0, 0, canvas.width/scale, canvas.height/scale);
         let dateSelectY = Number(dateInputY.value);
         let dateSelectM = Number(dateInputM.value);
         
         
         let xmin = 7;
         let xmax = 693;
         let xrange = xmax-xmin;
           
         let ymax = 10;
         let ymin = 130;
         let yrange = ymax-ymin;
          
         let MonthList = ['zeromonth',
                             'January',
                             'February',
                             'March',
                             'April',
                             'May',
                             'June',
                             'July',
                             'August',
                             'September',
                             'October',
                             'November',
                             'December'
                             ]
             context.textAlign = "center";
             context.font = "bold "+15+"px Helvetica";
             context.fillStyle = '#757575';
             context.fillText(dateSelectY,canvas.width/2/scale,20);
             context.font = "bold "+12+"px Helvetica";
             context.fillText(MonthList[dateSelectM],canvas.width/2/scale,32); 
          let DN = (dateSelectY+dateSelectM/12-dateSlider.min)/(dateSlider.max-dateSlider.min);
          //let nd = Math.floor((dateSlider.max % 1)*12)+Math.floor(dateSlider.max-dateSlider.min)*12;
          context.beginPath();
          context.moveTo(xmin+(DN)*xrange,0)
          context.lineTo(xmin+(DN)*xrange,800)
          context.strokeStyle = '#757575';
          context.stroke();
          
        }
        
          
         function SetupLaunchesGraph(ldata){
         var canvas = document.getElementById('LaunchGraphCanvas');
         var context = canvas.getContext('2d');
         
         var xsize = 700;
         var ysize = 160;
         canvas.style.width = xsize + "px";
         canvas.style.height = ysize + "px";
         
         // Set actual size in memory (scaled to account for extra pixel density).
         var scale = 4;//window.devicePixelRatio; // Change to 1 on retina screens to see blurry canvas.
         canvas.width = Math.floor(xsize * scale);
         canvas.height = Math.floor(ysize * scale);
         
         // Normalize coordinate system to use css pixels.
         context.scale(scale, scale);
         
         context.clearRect(0, 0, canvas.width/scale, canvas.height/scale);
         
         
         let xmin = 7;
         let xmax = 693;
         let xrange = xmax-xmin;
           
         let ymax = 10;
         let ymin = 130;
         let yrange = ymax-ymin;
           
             context.beginPath();
         context.moveTo(xmin,140);
         context.lineTo(xmin,120);
         context.lineWidth = 3;
         context.strokeStyle = 'rgb('+math.multiply([1,.6,0],255)+')';
         context.stroke();
         context.closePath();
             context.beginPath();
         context.moveTo(xmax,140);
         context.lineTo(xmax,120);
         context.lineWidth = 3;
         context.strokeStyle = 'rgb('+math.multiply([1,.6,0],255)+')';
         context.stroke();
         context.closePath();
         
         let cumulativeCheck = cumulativeLaunchesCheck.checked;
         let ICBMcheck = ICBMCheck.checked;
         let IRBMcheck = IRBMCheck.checked;
         let MRBMcheck = MRBMCheck.checked;
         let SRBMcheck = SRBMCheck.checked;
         let SLVcheck  = SLVCheck.checked;
           
         let nd = Math.floor((dateSlider.max % 1)*12)+Math.floor(dateSlider.max-dateSlider.min)*12;
           //console.log(nd)
         context.lineWidth = 1;
         context.strokeStyle = 'rgb('+math.multiply([0,0,0],255)+')';
           
           for(i=0;i<nd;i=i+12){
             context.beginPath();
             if ((i/12)%2 == 0){
             context.moveTo(xmin+i*xrange/nd,140)
             }else{
             context.moveTo(xmin+i*xrange/nd,138)
             }
             context.lineTo(xmin+i*xrange/nd,130)
             context.stroke();
             context.closePath();
             // Draw the text diagonally
             if ((i/12)%2 == 0){
            context.save(); // save current state
            let txtx = 6+xmin + i * xrange / nd;
            let txty = 150;
            let yrtxt = (1984+i/12).toString();
            context.textAlign = 'right';
            yrtxt = "'"+yrtxt.slice(2);
            context.translate(txtx, txty); 
            //context.rotate(-60*Math.PI/180);
            context.fillText(yrtxt, 0, 0);
            context.restore();
             };
           }
           let cs_all = new Array(nd).fill(0);
           let cs_SLV = new Array(nd).fill(0);
           let cs_SRBM = new Array(nd).fill(0);
           let cs_MRBM = new Array(nd).fill(0);
           let cs_IRBM = new Array(nd).fill(0);
           let cs_ICBM = new Array(nd).fill(0);
           let ns_all = new Array(nd).fill(0);
           let ns_SLV = new Array(nd).fill(0);
           let ns_SRBM = new Array(nd).fill(0);
           let ns_MRBM = new Array(nd).fill(0);
           let ns_IRBM = new Array(nd).fill(0);
           let ns_ICBM = new Array(nd).fill(0);
           
           //[0,0,1,0,1984,4,9,1,3,NaN,]
           //[150,650,2,0,2014,3,26,1,48,NaN,]
           
           // precalc normal and cumulative sums over dates(months)
           for(i=0;i<nd;i++){
             if (i>0){
               cs_SLV[i] = cs_SLV[i-1];
               cs_SRBM[i] = cs_SRBM[i-1];
               cs_MRBM[i] = cs_MRBM[i-1];
               cs_IRBM[i] = cs_IRBM[i-1];
               cs_ICBM[i] = cs_ICBM[i-1];
               cs_all[i] = cs_all[i-1];
             }
             for(j=0;j<ldata.length;j++){
               if ((ldata[j][4]*12+ldata[j][5])==i+12*1984){
                 if (ldata[j][2]==0){
                   cs_SLV[i]++;
                   ns_SLV[i]++;
                 }
                 if (ldata[j][2]==1){
                   cs_SRBM[i]++;
                   ns_SRBM[i]++;
                 }
                 if (ldata[j][2]==2){
                   cs_MRBM[i]++;
                   ns_MRBM[i]++;
                 }
                 if (ldata[j][2]==3){
                   cs_IRBM[i]++;
                   ns_IRBM[i]++;
                 }
                 if (ldata[j][2]==4){
                   cs_ICBM[i]++;
                   ns_ICBM[i]++;
                 }
                 cs_all[i]++;
                 ns_all[i]++;
               }
             }
           }
           
           let totalSLV = SLVcheck*cs_SLV[nd-1];
           let totalSRBM = SRBMcheck*cs_SRBM[nd-1];
           let totalMRBM = MRBMcheck*cs_MRBM[nd-1];
           let totalIRBM = IRBMcheck*cs_IRBM[nd-1];
           let totalICBM = ICBMcheck*cs_ICBM[nd-1];
           var totalShown
             if (cumulativeCheck==true){
               totalShown = totalSLV+totalSRBM+totalMRBM+totalIRBM+totalICBM;
             }else{
               totalShown = Math.max(...sumArrays(
                                                  math.multiply(SLVcheck,ns_SLV),
                                                  math.multiply(SRBMcheck,ns_SRBM),
                                                  math.multiply(MRBMcheck,ns_MRBM),
                                                  math.multiply(IRBMcheck,ns_IRBM),
                                                  math.multiply(ICBMcheck,ns_ICBM),
                                     ));
             }
           
           //console.log(totalShown)
           context.lineWidth = 0.1;
         context.strokeStyle = 'rgb('+math.multiply([0,0,0],255)+')';
           // ICBM
           if (ICBMcheck==true){
           context.beginPath();
           context.moveTo(xmin+0*xrange/nd,ymin)
           for (i=0;i<nd;i++){
             if (cumulativeCheck==true){
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (
                              ICBMcheck*cs_ICBM[i]+
                              IRBMcheck*cs_IRBM[i]+
                              MRBMcheck*cs_MRBM[i]+
                              SRBMcheck*cs_SRBM[i]+
                              SLVcheck*cs_SLV[i]
                              )
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (
                              ICBMcheck*cs_ICBM[i]+
                              IRBMcheck*cs_IRBM[i]+
                              MRBMcheck*cs_MRBM[i]+
                              SRBMcheck*cs_SRBM[i]+
                              SLVcheck*cs_SLV[i]
                              )
                              *yrange/totalShown)
             }else{
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (
                              ICBMcheck*ns_ICBM[i]+
                              IRBMcheck*ns_IRBM[i]+
                              MRBMcheck*ns_MRBM[i]+
                              SRBMcheck*ns_SRBM[i]+
                              SLVcheck*ns_SLV[i]
                              )
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (
                              ICBMcheck*ns_ICBM[i]+
                              IRBMcheck*ns_IRBM[i]+
                              MRBMcheck*ns_MRBM[i]+
                              SRBMcheck*ns_SRBM[i]+
                              SLVcheck*ns_SLV[i]
                              )
                              *yrange/totalShown)
             }
           }
           context.lineTo(xmax,ymin)
           context.lineTo(xmin,ymin)
           //context.stroke();
           context.closePath();
           context.fillStyle = 'rgb('+math.multiply([.75,0,.75],255)+')';
           context.fill();
           }
           // IRBM
           if (IRBMcheck==true){
           context.beginPath();
           context.moveTo(xmin+0*xrange/nd,ymin)
           for (i=0;i<nd;i++){
             if (cumulativeCheck==true){
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (
                              IRBMcheck*cs_IRBM[i]+
                              MRBMcheck*cs_MRBM[i]+
                              SRBMcheck*cs_SRBM[i]+
                              SLVcheck*cs_SLV[i]
                              )
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (
                              IRBMcheck*cs_IRBM[i]+
                              MRBMcheck*cs_MRBM[i]+
                              SRBMcheck*cs_SRBM[i]+
                              SLVcheck*cs_SLV[i]
                              )
                              *yrange/totalShown)
             }else{
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (
                              IRBMcheck*ns_IRBM[i]+
                              MRBMcheck*ns_MRBM[i]+
                              SRBMcheck*ns_SRBM[i]+
                              SLVcheck*ns_SLV[i]
                              )
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (
                              IRBMcheck*ns_IRBM[i]+
                              MRBMcheck*ns_MRBM[i]+
                              SRBMcheck*ns_SRBM[i]+
                              SLVcheck*ns_SLV[i]
                              )
                              *yrange/totalShown)
             }
           }
           context.lineTo(xmax,ymin)
           context.lineTo(xmin,ymin)
           //context.stroke();
           context.closePath();
           context.fillStyle = 'rgb('+math.multiply([1,.2,0],255)+')';
           context.fill();
           }
           // MRBM
           if (MRBMcheck==true){
           context.beginPath();
           context.moveTo(xmin+0*xrange/nd,ymin)
           for (i=0;i<nd;i++){
             if (cumulativeCheck==true){
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (
                              MRBMcheck*cs_MRBM[i]+
                              SRBMcheck*cs_SRBM[i]+
                              SLVcheck*cs_SLV[i]
                              )
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (
                              MRBMcheck*cs_MRBM[i]+
                              SRBMcheck*cs_SRBM[i]+
                              SLVcheck*cs_SLV[i]
                              )
                              *yrange/totalShown)
             }else{
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (
                              MRBMcheck*ns_MRBM[i]+
                              SRBMcheck*ns_SRBM[i]+
                              SLVcheck*ns_SLV[i]
                              )
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (
                              MRBMcheck*ns_MRBM[i]+
                              SRBMcheck*ns_SRBM[i]+
                              SLVcheck*ns_SLV[i]
                              )
                              *yrange/totalShown)
             }
           }
           context.lineTo(xmax,ymin)
           context.lineTo(xmin,ymin)
           //context.stroke();
           context.closePath();
           context.fillStyle = 'rgb('+math.multiply([1,.6,0],255)+')';
           context.fill();
           }
           // SRBM
           if (SRBMcheck==true){
           context.beginPath();
           context.moveTo(xmin+0*xrange/nd,ymin)
           for (i=0;i<nd;i++){
             if (cumulativeCheck==true){
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (
                              SRBMcheck*cs_SRBM[i]+
                              SLVcheck*cs_SLV[i]
                              )
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (
                              SRBMcheck*cs_SRBM[i]+
                              SLVcheck*cs_SLV[i]
                              )
                              *yrange/totalShown)
             }else{
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (
                              SRBMcheck*ns_SRBM[i]+
                              SLVcheck*ns_SLV[i]
                              )
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (
                              SRBMcheck*ns_SRBM[i]+
                              SLVcheck*ns_SLV[i]
                              )
                              *yrange/totalShown)
             }
           }
           context.lineTo(xmax,ymin)
           context.lineTo(xmin,ymin)
           //context.stroke();
           context.closePath();
           context.fillStyle = 'rgb('+math.multiply([.2,.7,.4],255)+')';
           context.fill();
           }
           // SLV
           if (SLVcheck==true){
           context.beginPath();
           context.moveTo(xmin+0*xrange/nd,ymin)
           for (i=0;i<nd;i++){
             if (cumulativeCheck==true){
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (SLVcheck*cs_SLV[i])
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (SLVcheck*cs_SLV[i])
                              *yrange/totalShown)
             }else{
             if (i > 0){
               context.lineTo(xmin+(i-1)*xrange/nd,ymin+
                              (SLVcheck*ns_SLV[i])
                               *yrange/totalShown)
             }
             context.lineTo(xmin+i*xrange/nd,ymin+
                              (SLVcheck*ns_SLV[i])
                              *yrange/totalShown)
               
             }
           }
           context.lineTo(xmax,ymin)
           context.lineTo(xmin,ymin)
           //context.stroke();
           context.closePath();
           context.fillStyle = 'rgb('+math.multiply([.7,.7,.7],255)+')';
           context.fill();
           }
         }
         
         
         //%% Trajectory calculation
         var ER = 6371; //%earth radius
         var dx = 4; // delta x spread. 0.5 = ~20k pts. 2 = ~5000pts.
         var apogee
         var arc
         
         var xTrajectory = new Array(launchdata.length).fill(NaN).map(() => new Array(2).fill(NaN));
         var yTrajectory = new Array(launchdata.length).fill(NaN).map(() => new Array(2).fill(NaN));
         var hypxTrajectory = new Array(launchdata.length).fill(NaN).map(() => new Array(2).fill(NaN));
         var hypyTrajectory = new Array(launchdata.length).fill(NaN).map(() => new Array(2).fill(NaN));
         
         for (i = 0; i < launchdata.length; i++) { //launchdata.length
         apogee = launchdata[i][0]; //%altitude reached
         arc = launchdata[i][1];    //%ground distance
         
         xyRotated = generateTrajectory(apogee,arc,dx);
         
         if (!isNaN(launchdata[i][9])){
           hypxyRotated = generateTrajectory(Math.max(apogee*arc/launchdata[i][9],apogee/3),launchdata[i][9],dx/2); //
         }
         //var xRotated = xyRotated[][0];//(:,1);
         //var yRotated = xyRotated[][1];//(:,2);
         
         //%store trajectory in cartesian matrix:
         
         for (j = 0; j < xyRotated.length; j++) {
             xTrajectory[i][j] = xyRotated[j][0];//xRotated(j);
             yTrajectory[i][j] = xyRotated[j][1];//yRotated(j);
         }
         if (!isNaN(launchdata[i][9])){
           for (j = 0; j < hypxyRotated.length; j++) {
               hypxTrajectory[i][j] = hypxyRotated[j][0];//xRotated(j);
               hypyTrajectory[i][j] = hypxyRotated[j][1];//yRotated(j);
           }
         }
         
         }
         
         function generateTrajectory(apogee,arc,dx){
         var centerAngle
         var Angle
         var chord
         var sagitta
         centerAngle = -0.5*(arc/(Math.PI*ER))*180; //%angle between apex & launch (deg)
         Angle = centerAngle*Math.PI/180; //%convert back to radians
         chord = -2*ER*Math.sin(Angle); //%(full) minor axis length
         sagitta = ER-Math.sqrt(Math.pow(ER,2)-Math.pow((chord/2),2)); //%dist from earth surface to chord midpoint
         
         var x1=[0,0];                   //%first point of parabola
         var x2=[chord/2,(apogee+sagitta)];//%parabola apex point
         var x3=[chord,0];               //%last point of parabola
         var y = math.matrix([[x1[1]], [x2[1]], [x3[1]]]);//y=[x1(2);x2(2);x3(2)];
         var A = math.matrix([
                             [Math.pow(x1[0],2),x1[0],1],
                             [Math.pow(x2[0],2),x2[0],1],
                             [Math.pow(x3[0],2),x3[0],1],
                             ]);//A=[x1(1)^2 x1(1) 1;x2(1)^2 x2(1) 1;x3(1)^2 x3(1) 1];
         var X=math.multiply(math.inv(A),y);
         
         //var x = x1(1):0.5:x3(1);
         var x = [];
         for (var j = x1[0]; j <= x3[0]; j+= dx) {
            x.push(j);
         }
         //var y = X(1)*x.^2+X(2)*x+ER;
         var y = new Array(x.length).fill(0);
         for (var j = 0; j< x.length; j++){
           y[j] = X._data[0]*Math.pow(x[j],2)+X._data[1]*x[j]+ER;
         }
         
         //% point to rotate about: [0,6371];
         var xc = 0;
         var yc = ER;
         //%transform matrix: rotate about arbitrary point:
         var M = [
             [Math.cos(Angle), Math.sin(Angle), 0],//;...
             [-Math.sin(Angle), Math.cos(Angle), 0],//;...
             [-xc*Math.cos(Angle)+yc*Math.sin(Angle)+xc, -xc*Math.sin(Angle)-yc*Math.cos(Angle)+yc, 1],//;
             ];//
         
         //xyAligned = [x;y;ones(1,length(x))]';
         var onearray = new Array(x.length).fill(1);
         
         
         var xyAligned = math.ctranspose(math.concat([x],[y],[onearray],0));
         
         var xyRotated = math.multiply(xyAligned,M)
         
         return xyRotated;
         }
         
         
         let ldata = launchdata;
         let xt = xTrajectory;
         let yt = yTrajectory;
         let hypxt = hypxTrajectory;
         let hypyt = hypyTrajectory;
         
         DrawTrajectories();
         
         function ZoomChangeFunction(val){
         let zoomval = val;//-val+100;
         DrawTrajectories();
         }
         function DateChangeFunction(val){
         let dateval = val;//-val+100;
         DrawTrajectories();
         SetupLaunchDateGraph();
         }
         function CumulativeLaunchesChangeFunction(val){
         let cumval = val;//-val+100;
         DrawTrajectories();
         SetupLaunchesGraph(launchdata);
         }
         function VehicleChangeFunction(){
         DrawTrajectories();
         SetupLaunchesGraph(launchdata);
         }
         
         
         function DrawTrajectories(){
         
         let zoomcase = Number(zoomSlider.value);
         let dateSelectY = Number(dateInputY.value);
         let dateSelectM = Number(dateInputM.value);
         
         let cumulativeCheck = cumulativeLaunchesCheck.checked;
         let ICBMcheck = ICBMCheck.checked;
         let IRBMcheck = IRBMCheck.checked;
         let MRBMcheck = MRBMCheck.checked;
         let SRBMcheck = SRBMCheck.checked;
         let SLVcheck  = SLVCheck.checked;
         
         //ldata,xt,yt,zoomcase)
         var canvas = document.getElementById('TrajCanvas');
         var context = canvas.getContext('2d');
         
         var xsize = 700;
         var ysize = 600;
         canvas.style.width = xsize + "px";
         canvas.style.height = ysize + "px";
         
         // Set actual size in memory (scaled to account for extra pixel density).
         var scale = 2;//window.devicePixelRatio; // Change to 1 on retina screens to see blurry canvas.
         canvas.width = Math.floor(xsize * scale);
         canvas.height = Math.floor(ysize * scale);
         
         
         // Normalize coordinate system to use css pixels.
         context.scale(scale, scale);
         
         context.clearRect(0, 0, canvas.width/scale, canvas.height/scale);
         //console.log('trajectory matrix size:')
         //console.log(xt.length)
         //console.log(xt[0].length)
         
         ER = 6371;
         MR = 1737;
         E2M = 384400;
         
         //let zoomcase = 1;
         //0 = Earth+Moon
         //1 = WholeEarth
         //2 = ImportantCountries (original)
         //3 = East Asia
         //4 = Korea
         //5 = Atmosphere
         
         let zoomid = [];
         let cxid = [];
         let cyid = [];
         for (zoomcasei = 0; zoomcasei <= 5; zoomcasei++) {
         if (zoomcasei == 0){
         //Earth+Moon/GeostationaryOrbit?
         zoomid.push(0.0015);
         cxid.push(canvas.width*0.0225/scale);
         cyid.push(canvas.height*0.975/scale);
         }else if (zoomcasei == 1){
         //WholeEarth
         zoomid.push(0.029);
         cxid.push(canvas.width*0.35/scale);
         cyid.push(canvas.height*0.68/scale);
         }else if (zoomcasei == 2){
         //ImportantCountries (Original View)
         zoomid.push(0.0375);
         cxid.push(canvas.width*0.125/scale);
         cyid.push(canvas.height*0.9/scale);
         }else if (zoomcasei == 3){
         //Just East Asia
         zoomid.push(0.2);
         cxid.push(canvas.width*0.125/scale);
         cyid.push(canvas.height*2.5/scale);
         }else if (zoomcasei == 4){
         //Korea
         zoomid.push(0.75);
         cxid.push(canvas.width*0.125/scale);
         cyid.push(canvas.height*8.5/scale);
         }else if (zoomcasei == 5){
         //Atmosphere
         zoomid.push(3);
         cxid.push(canvas.width*0.125/scale);
         cyid.push(canvas.height*32.6/scale);
         }
         }
         
         zoomid = interpolateArray(zoomid,Number(zoomSlider.max)+1)
         cxid = interpolateArray(cxid, Number(zoomSlider.max)+1)
         cyid = interpolateArray(cyid, Number(zoomSlider.max)+1)
         
         let zoom = zoomid[zoomcase];
         let cx = cxid[zoomcase];
         let cy = cyid[zoomcase];
         
         //Atmosphere
           context.moveTo(cx,cy-(ER+100)*zoom);
           context.beginPath();
           context.lineJoin = "round";
           context.ellipse(cx, cy, (ER+100)*zoom, (ER+100)*zoom, 0, 0, 2*Math.PI)
           context.strokeStyle = 'rgb('+math.multiply([0.0,0.9,0.9],255)+')';
           context.lineWidth = 1;
           context.fillStyle= 'rgb('+math.multiply([0.8,0.99,0.99],255)+')';
           context.fill();
           context.closePath();
         
         //Measurement Rings
         var ringAlt
         var ringLabel
           let rings = ['ATMOSPHERE',0.2,0.5,1,2,3,4,5,7.5,10,20,'GEO',50,100,200,300,'MOON',500];
         context.save();
           context.translate(cx, cy);
             
           for (i = 0; i < rings.length; i++){      
                                              var atmosAng = -0.232 * Math.pow(zoom, -1.07);
             if (i==0){
                      context.rotate((atmosAng)*Math.PI/180);
             }else if (i==1){ context.rotate((45-atmosAng)*Math.PI/180);
               
             };
             
             if (typeof(rings[i]) == 'string'){
                 context.font = "bold 12px Helvetica";
                 if (rings[i] == 'GEO'){
                   ringAlt = 35.786;
                   ringLabel = 'Geostationary Orbit';
                   context.textAlign = "center";
             context.fillStyle = 'rgb('+math.multiply([0.7,0.7,0.7],255)+')';context.strokeStyle = 'rgb('+math.multiply([0.9,0.9,0.9],255)+')';
                 }else if (rings[i] == 'MOON'){
                   ringAlt = (E2M-ER)/1000;
                   ringLabel = 'The Moon';
                   context.textAlign = "center";
             context.fillStyle = 'rgb('+math.multiply([0.7,0.7,0.7],255)+')';context.strokeStyle = 'rgb('+math.multiply([0.9,0.9,0.9],255)+')';
                 }else if (rings[i] == 'ATMOSPHERE'){
                   ringAlt = 100.5/1000;
                   if (zoom > 0.025){
                   ringLabel = 'Atmosphere';}else {ringLabel = '';}; context.font = "10px Helvetica";context.textAlign = "center";
             context.fillStyle = 'rgb('+math.multiply([0.0,0.8,0.8],255)+')';context.strokeStyle = 'rgb('+math.multiply([0.0,0.9,0.9],255)+')';
                 }
             }else{
                 context.font = "12px Helvetica";
                 ringAlt = rings[i];
                 ringLabel = (rings[i]*1000).toString()+' km';
               context.textAlign = "center";
             context.fillStyle = 'rgb('+math.multiply([0.7,0.7,0.7],255)+')';context.strokeStyle = 'rgb('+math.multiply([0.9,0.9,0.9],255)+')';
             }
             
             context.moveTo(0,-(ER+ringAlt*1000)*zoom);
             context.beginPath();
             context.lineJoin = "round";
             context.ellipse(0, 0, (ER+ringAlt*1000)*zoom, (ER+ringAlt*1000)*zoom, 0, 0, 2*Math.PI)
             
             context.lineWidth = 1;
             //context.setLineDash([2,2]);
             context.stroke();
             context.closePath();
             context.fillText(ringLabel,0*(ER+ringAlt*1000)*zoom,-(ER+ringAlt*1000)*zoom)
           }
         context.restore();
         
               
           //earthBG
           context.moveTo(cx,cy-(ER)*zoom);
           context.beginPath();
           context.lineJoin = "round";
           context.ellipse(cx, cy, (ER)*zoom, (ER)*zoom, 0, 0, 2*Math.PI)
           context.lineWidth = 1;
           context.fillStyle= 'rgb('+math.multiply([1.0,1.0,1.0],255)+')';
           context.fill();
           context.closePath();
         
           //Moon
           if (Number(zoomSlider.value) < 20){
             context.moveTo(cx,cy-ER*zoom);
             context.beginPath();
             context.lineJoin = "round";
             context.ellipse(cx+(E2M*Math.cos(40*Math.PI/180))*zoom, cy-(E2M*Math.sin(40*Math.PI/180))*zoom, MR*zoom, MR*zoom, 0, 0, 2*Math.PI)
             context.strokeStyle = 'rgb('+math.multiply([0.5,0.5,0.5],255)+')';
             context.fillStyle = context.strokeStyle;
             context.lineWidth = 1;
             context.stroke();
             context.fill();
             context.closePath();
           }
         
         //LandMasses     NAME,ArcW,ArcE,level,labelcolor
         //,'DMZ-1',135,'DMZ-2',160
         var LandMasses
           if (zoomSlider.value >= 566){
             LandMasses = [
               ['Korea',246.5,246.5,0,1],
               ['North Korea',-157,560,0,1,'Pyongyang',0],
               ['South Korea', 150,650,0,1,'Seoul',194.71],
             ];
               if (zoomSlider.value >= 650){
                 LandMasses.push(['DMZ',135,160,0,1]);
               }
           }else{
           LandMasses = [                   ['Korea',-157,650,0,1,'Pyongyang',0],
             ];
             if (zoomSlider.value >= 425){ LandMasses.push(['',0,0,0,1,'Seoul',194.71]);
              }
           }
         
         //CONTINENTS
         
           if (Asia.checked == true){
         LandMasses.push(['Asia',-8420,5360,1,1]);
           }
           if (NorthAmerica.checked == true){
         LandMasses.push(['N.America',5000,14200,1,1]);
           }
           if (Europe.checked == true){
         LandMasses.push(['Europe',-4800,-10375,1,1]);
           }
           if (Oceania.checked == true){
         LandMasses.push(['Oceania (W)',-5930,-8234,1,1]);
         LandMasses.push(['Oceania (E)',4900,10740,1,1]);
           }
           if (Africa.checked == true){
         LandMasses.push(['Africa',-8000,-13700,1,1]);
           }
           if (SouthAmerica.checked == true){
         LandMasses.push(['S.America',14000,19800,1,1]);
           }
           if (Antarctica.checked == true){
         LandMasses.push(['Antarctica',-11600,-17300,1,1]);
           }
         
         // COUNTRIES
         
           if (Japan.checked == true){
         LandMasses.push(['Japan',685,1720,0,1,'Tokyo',801.55]);
           }
           if (China.checked == true){
         LandMasses.push(['China (W)',-4400,-169,0,1,'Beijing',-809.87]);
             LandMasses.push(['China (E)',196,1250,0,1]);
           }
           if (Russia.checked == true){
         LandMasses.push(['Russia (W)',-6900,-1330,0,1,'Moscow',-6413]);
             LandMasses.push(['Russia (E)',580,4950,0,1]);
           }
           if (Guam.checked == true){
         LandMasses.push(['Guam',3488,3520,0,0,'Hagåtña',3498.73]);
           }
           if (Alaska.checked == true){
         LandMasses.push(['Alaska',5000,7100,0,1,'Anchorage',5997.60]);
           }
           if (Hawaii.checked == true){
         LandMasses.push(['Hawaii',7180,7770,0,1,'Honolulu',7391.77]);
           }
           if (USAC.checked == true){
         LandMasses.push(['USA (Cont.)',8090,12380,0,1,'San Francisco',9000.47,'Seattle',8267,'Washington DC',11045.84,'Miami',12326.00]);
           }
           if (Canada.checked == true){
         LandMasses.push(['Canada',6100,10777,0,1,'Toronto',10480]);
           }
           if (India.checked == true){
         LandMasses.push(['India',-2800,-5900,0,1,'New Delhi',-4573.22]);
           }
           if (Germany.checked == true){
         LandMasses.push(['Germany',-8600,-7770,0,1,'Berlin',-7920]);
           }
           if (UK.checked == true){
         LandMasses.push(['UK',-7900,-9035,0,1,'London',-8664.21]);
           }
           if (France.checked == true){
         LandMasses.push(['France',-8470,-9437,0,1,'Paris',-8770]);
           }
           if (Australia.checked == true){
         LandMasses.push(['Australia',5623,9447,0,1,'Canberra',8604.18]);
           }
           if (Nigeria.checked == true){
         LandMasses.push(['Nigeria',-12290,-10870,0,1,'Lagos',-12210]);
           }
           if (SouthAfrica.checked == true){
         LandMasses.push(['S.Africa',-11918,-13680,0,1,'Cape Town',-13668.03]);
           }
           if (Brazil.checked == true){
         LandMasses.push(['Brazil',15000,19400,0,1,'São Paulo',18150.69]);
           }
         
                         //Argentina?
                         //Egypt?
                         //*/
                         //];
         let maxlevel = 2.5;
         for (i = 0; i < LandMasses.length; i++){
           let LMRtop = 1-1*LandMasses[i][3]/maxlevel;
           let LMRbot = 1+0.01-1*(LandMasses[i][3]+1)/maxlevel;
           context.moveTo(cx,cy)
           context.beginPath();
           context.lineJoin = "round";
           //context.lineTo(cx,cy)
           context.lineTo(cx-ER*zoom*Math.cos(LandMasses[i][1]/ER+Math.PI/2),cy-ER*zoom*Math.sin(LandMasses[i][1]/ER+Math.PI/2));
           context.ellipse(cx,cy,ER*LMRtop*zoom,ER*LMRtop*zoom,-Math.PI/2,
                   LandMasses[i][1]/ER,
                   LandMasses[i][2]/ER,
                   LandMasses[i][1]>LandMasses[i][2]);
           //context.lineTo(cx,cy)
           context.ellipse(cx,cy,ER*LMRbot*zoom,ER*LMRbot*zoom,-Math.PI/2,
                   LandMasses[i][2]/ER,
                   LandMasses[i][1]/ER,
                   !(LandMasses[i][1]>LandMasses[i][2]));
           context.globalAlpha = 0.45;
           if (LandMasses[i][0] == 'DMZ'){
             context.fillStyle = '#757575';
           }else{
             context.fillStyle = '#328a20';
           }
           context.closePath();
           context.fill();
           //context.strokeStyle = '#00508a';
           //context.stroke();
           context.globalAlpha = 1;
         }
         //landmass labels
         for (i = 0; i < LandMasses.length; i++){
           let LMRtop = 1-1*LandMasses[i][3]/maxlevel;
           let LMRbot = 1+0.025-1*(LandMasses[i][3]+1)/maxlevel;
           context.save();
           context.translate(cx, cy);
           if (LandMasses[i][0] == 'North Korea'){
                 let midangle = 0+Math.PI/2;
                 context.fillStyle = '#ffffff';
                 context.font = "bold "+Math.min(12*0.1*zoom*265,18)+"px Helvetica";
                 context.textAlign = "center";
                 context.fillText('North',0,-(ER-Math.min(200/zoom,2000))*zoom);
                 context.fillText('Korea',0,-(ER-Math.min(220/zoom,2000))*zoom);
           }else if (LandMasses[i][0] == 'South Korea'){
                 let midangle = 5*Math.PI/180+Math.PI/2;
                 context.fillStyle = '#ffffff';
                 context.font = "bold "+Math.min(12*0.1*zoom*265,18)+"px Helvetica";
                 context.textAlign = "center";
                 context.fillText('South',ER*0.038*zoom,-(ER-Math.min(200/zoom,2000))*zoom);
                 context.fillText('Korea',ER*0.038*zoom,-(ER-Math.min(220/zoom,2000))*zoom);
             }else if (LandMasses[i][0] == 'DMZ'){
                 let midangle = ((LandMasses[i][1]+LandMasses[i][2])/2)/ER+Math.PI/2;
                 context.fillStyle = '#ffffff';
                 context.font = "bold "+Math.min(12*0.1*zoom*265,18)+"px Helvetica";
                 context.textAlign = "right";              context.rotate(midangle+Math.PI+Math.max(0.5/(zoom*9),0.02)*Math.PI/180);
                 context.fillText('DMZ',(ER-Math.min(25/zoom,300))*zoom,0);
           }else{
               if (LandMasses[i][4] == 0){
                 context.fillStyle = '#e7e7e7';
               }else{
                 context.fillStyle = '#ffffff';
               }
               context.font = "bold "+15*0.1*zoom*265+"px Helvetica";
               //console.log(15*zoomSlider.value/275)
               let midangle = ((LandMasses[i][1]+LandMasses[i][2])/2)/ER+Math.PI/2;
               //console.log(midangle*180/Math.PI)
               if (midangle > Math.PI/2 && midangle < 3*Math.PI/2){
                 context.rotate(midangle+Math.PI+LandMasses[i][4]*2*Math.PI/180);
                 context.textAlign = "left";
                 context.fillText(LandMasses[i][0],ER*LMRbot*zoom,0);
               }else{
                 context.rotate(midangle-LandMasses[i][4]*2*Math.PI/180)
                 context.textAlign = "right";
               context.fillText(LandMasses[i][0],-ER*LMRbot*zoom,0);
               }
         }
           context.restore();
         }
         
         //Cities
         for (i = 0; i < LandMasses.length; i++){
           for (j = 5; j < LandMasses[i].length; j+=2){
           context.moveTo(cx-ER*zoom*Math.cos(LandMasses[i][j+1]/ER+Math.PI/2),cy-ER*zoom*Math.sin(LandMasses[i][j+1]/ER+Math.PI/2))
           context.beginPath();
           context.lineJoin = "round";
           context.lineTo(cx-ER*zoom*Math.cos((0.1/zoom)*0.3*Math.PI/180+LandMasses[i][j+1]/ER+Math.PI/2),cy-ER*zoom*Math.sin((0.1/zoom)*0.3*Math.PI/180+LandMasses[i][j+1]/ER+Math.PI/2))
           context.lineTo(cx-ER*zoom*Math.cos((0.1/zoom)*-0.3*Math.PI/180+LandMasses[i][j+1]/ER+Math.PI/2),cy-ER*zoom*Math.sin((0.1/zoom)*-0.3*Math.PI/180+LandMasses[i][j+1]/ER+Math.PI/2))
           context.lineTo(cx-(ER-Math.min(30/zoom,300))*zoom*Math.cos(LandMasses[i][j+1]/ER+Math.PI/2),cy-(ER-Math.min(30/zoom,300))*zoom*Math.sin(LandMasses[i][j+1]/ER+Math.PI/2))
           
           //context.lineTo(cx,cy)
           if (LandMasses[i][j] == 'Pyongyang'){
             context.fillStyle = '#ff0000';
             context.strokeStyle = '#000000';
           }else{
             context.fillStyle = '#000000';
             context.strokeStyle = '#ffffff';
           }
           context.closePath();
           context.fill();
           context.stroke();
           }
         }
         //city labels
         for (i = 0; i < LandMasses.length; i++){
           for (j = 5; j < LandMasses[i].length; j+=2){
           let LMRtop = 1.33-1*LandMasses[i][3]/maxlevel;
           let LMRbot = 1.33+0.025-1*(LandMasses[i][3]+1)/maxlevel;
           context.save();
           context.translate(cx, cy);
           context.fillStyle = '#000000';
           if (zoomSlider.value >=360){
           context.font = "bold "+Math.min(9*0.1*zoom*265,15)+"px Helvetica"; //0.1*zoom*265
           }else{
           context.font = "bold "+9*0.1*zoom*265+"px Helvetica";
           }
           //console.log(15*zoomSlider.value/275)
           let midangle = LandMasses[i][j+1]/ER+Math.PI/2;//((LandMasses[i][1]+LandMasses[i][2])/2)/ER+Math.PI/2;
           //console.log(midangle*180/Math.PI)
           if (midangle >= Math.PI/2 && midangle < 3*Math.PI/2){
             context.rotate(midangle+Math.PI+Math.max(0.5/(zoom*17),0.014)*Math.PI/180); //
             context.textAlign = "right";
             context.fillText(LandMasses[i][j],(ER-Math.min(40/zoom,300))*zoom,0); //ER*LMRbot*zoom
           }else{
             context.rotate(midangle-Math.max(0.5/(zoom*17),0.014)*Math.PI/180) //-LandMasses[i][4]*2*Math.PI/180
             context.textAlign = "left";
           context.fillText(LandMasses[i][j],-(ER-Math.min(40/zoom,300))*zoom,0); //-ER*LMRbot*zoom
           }
           context.restore();
           }
         }
         
           //Earth surface
           context.moveTo(cx,cy-ER*zoom);
           context.beginPath();
           context.lineJoin = "round";
           context.ellipse(cx, cy, ER*zoom, ER*zoom, 0, 0, 2*Math.PI)
           context.strokeStyle = 'rgb('+math.multiply([0.0,0.0,0.0],255)+')';
           context.lineWidth = 2;
           context.stroke();
           context.closePath();
           /*
           //Earth whitespace
           context.moveTo(cx,cy-ER*0.5*zoom);
           context.beginPath();
           context.lineJoin = "round";
           context.ellipse(cx, cy, ER*0.5*zoom, ER*0.5*zoom, 0, 0, 2*Math.PI)
           context.fillStyle = '#ffffff';
           context.lineWidth = 2;
           context.fill();
           context.closePath();
         /*
           */
            let MonthList = ['zeromonth',
                             'January',
                             'February',
                             'March',
                             'April',
                             'May',
                             'June',
                             'July',
                             'August',
                             'September',
                             'October',
                             'November',
                             'December'
                             ]
             context.textAlign = "left";
             context.font = "bold "+15+"px Helvetica";
             context.fillStyle = '#757575';
             context.fillText(dateSelectY,10,17.5);
             context.font = "bold "+12+"px Helvetica";
             context.fillText(MonthList[dateSelectM],10,32); 
             //context.fillText(dateSelectY,cx,cy); //ER*LMRbot*zoom
           
           
         //Plot Trajectories
         for (i = 0; i < xt.length; i++) {
           var PlotValid = false;
           if ((ldata[i][4]+ldata[i][5]/12 <= dateSelectY+dateSelectM/12 && cumulativeCheck == true) || (ldata[i][4] == dateSelectY && ldata[i][5] == dateSelectM)){
           context.lineWidth = 1;
           context.beginPath();
           context.lineJoin = "round";
           context.moveTo(cx,cy-ER*zoom);
           if (HypRangeCheck.checked == false || isNaN(hypxt[i][0])){
           for (j = 0; j < xt[i].length; j++) {
             context.lineTo(cx+xt[i][j]*zoom,cy-yt[i][j]*zoom);
           }
           context.lineTo(cx-ER*zoom*Math.cos(ldata[i][1]/ER+Math.PI/2),cy-ER*zoom*Math.sin(ldata[i][1]/ER+Math.PI/2));
           }else{
           for (j = 0; j < hypxt[i].length; j++) {
             context.lineTo(cx+(hypxt[i][j])*zoom,cy-hypyt[i][j]*zoom);
           }
           context.lineTo(cx-ER*zoom*Math.cos(ldata[i][9]/ER+Math.PI/2),cy-ER*zoom*Math.sin(ldata[i][9]/ER+Math.PI/2));
             
           }
           if (ldata[i][2] == 0 && SLVcheck == true){ //SLV
           PlotValid = true;
           context.strokeStyle = 'rgb('+math.multiply([0.7,0.7,0.7],255)+')';
           //------------------------------------
           } else if (ldata[i][2] == 1 && SRBMcheck == true){ //SRBM
           PlotValid = true;
           context.strokeStyle = 'rgb('+math.multiply([0.2,0.7,0.4],255)+')';
           //------------------------------------
           } else if (ldata[i][2] == 2 && MRBMcheck == true){ //MRBM
           PlotValid = true;
           context.strokeStyle = 'rgb('+math.multiply([1.0,0.6,0.0],255)+')';
           //------------------------------------
           } else if (ldata[i][2] == 3 && IRBMcheck == true){ //IRBM
           PlotValid = true;
           context.strokeStyle = 'rgb('+math.multiply([1.0,0.2,0.0],255)+')';
           //------------------------------------
           } else if (ldata[i][2] == 4 && ICBMcheck == true){ //ICBM
           PlotValid = true;
           context.strokeStyle = 'rgb('+math.multiply([.75,0.0,.75],255)+')';
           //------------------------------------
           }
           if (ldata[i][7] == 0){
             context.setLineDash([3,3]);
           }else if (!isNaN(ldata[i][9]) && HypRangeCheck.checked == true){
             context.setLineDash([10,3]);
           }else{
             context.setLineDash([]);
           }
           if (PlotValid == true){
             context.stroke();
           }
           }
         }
         
         }
         
         function interpolateArray(data, fitCount) {
         
         var linearInterpolate = function (before, after, atPoint) {
             return before + (after - before) * atPoint;
         };
         
         var newData = new Array();
         var springFactor = new Number((data.length - 1) / (fitCount - 1));
         newData[0] = data[0]; // for new allocation
         for ( var i = 1; i < fitCount - 1; i++) {
             var tmp = i * springFactor;
             var before = new Number(Math.floor(tmp)).toFixed();
             var after = new Number(Math.ceil(tmp)).toFixed();
             var atPoint = tmp - before;
             newData[i] = linearInterpolate(data[before], data[after], atPoint);
         }
         newData[fitCount - 1] = data[data.length - 1]; // for new allocation
         return newData;
         };
         function sumArrays(...arrays) {
  const n = arrays.reduce((max, xs) => Math.max(max, xs.length), 0);
  const result = Array.from({ length: n });
  return result.map((_, i) => arrays.map(xs => xs[i] || 0).reduce((sum, x) => sum + x, 0));
}
      </script>
   </body>
</html>
