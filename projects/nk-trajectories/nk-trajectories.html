<!DOCTYPE html>
<html>
<head>
  <style>
    /*html, body {margin: 0; height: 100%; overflow: hidden}*/
    input[type='number']::-webkit-inner-spin-button,
    input[type='number']::-webkit-outer-spin-button {
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
    }

    .sliderInput {
      -webkit-appearance: none;
      appearance: none;
      position: absolute;
      height: 12px;
      width: 50px;
      border-radius: 5px;
      text-align: center;
      font-family: Courier New, serif;
      font-weight: bold;
      color: #00508a;
    }

    .slider {
      -webkit-appearance: none;
      appearance: none;
      position: absolute;
      width: 200px;
      height: 15px;
      border-radius: 15px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.8;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      perspective: 1px;
      width: 20px;
      height: 20px;
      border: 3px solid #00508a;
      border-collapse: separate;
      border-radius: 20px;
      background: #ffffff;
      opacity: 1;
      cursor: grab;
    }

    .slider:hover {
      opacity: 1;
      /* Fully shown on mouse-over */
      background: #189aca;
      cursor: pointer;
    }
  </style>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.4/math.js'></script>
  </head>
<body>
  <canvas id="BorderCanvas"></canvas>
  <script type="text/javascript">
    var canvas = document.getElementById('BorderCanvas');
    if (canvas.getContext) {
      var context = canvas.getContext('2d');
      var xsize = 880;
      var ysize = 1425;
      canvas.style.width = xsize + "px";
      canvas.style.height = ysize + "px";
      // Set actual size in memory (scaled to account for extra pixel density).
      var scale = 1; //window.devicePixelRatio; // Change to 1 on retina screens to see blurry canvas.
      canvas.width = Math.floor(xsize * scale);
      canvas.height = Math.floor(ysize * scale);
      // Normalize coordinate system to use css pixels.
      context.scale(scale, scale);
      context.clearRect(0, 0, canvas.width / scale, canvas.height / scale);
      context.beginPath();
      context.lineJoin = "round";
      context.moveTo(0, 0);
      context.lineTo(canvas.width / scale, 0);
      context.strokeStyle = '#00508a';
      context.stroke();
      ////
      context.beginPath();
      context.lineJoin = "round";
      context.moveTo(0, 0);
      context.lineTo(0, canvas.height / scale);
      context.stroke();
      ////
      context.beginPath();
      context.lineJoin = "round";
      context.moveTo(canvas.width / scale, canvas.height / scale);
      context.lineTo(canvas.width / scale, 0);
      context.stroke();
      ////
      context.beginPath();
      context.lineJoin = "round";
      context.moveTo(canvas.width / scale, canvas.height / scale);
      context.lineTo(0, canvas.height / scale);
      context.stroke();
      ////
    }
  </script>
  <canvas id="TrajCanvas" width="600px" height="600px"
    style="position:absolute;top:20px;left:70px;border: 1px solid #00508a";></canvas>
  
      <div class="slidecontainer">
      <form>
        <input id="zoomSlider" class="slider" type="range" name="zoomSlider" min="0" max="900" step="1" value="360" style="writing-mode: bt-lr; /* IE */
    -webkit-appearance: slider-vertical; /* Chromium */
    width: 8px;
    height: 175px;
    position:absolute;
    top: 50px;
    left: 750px;" oninput="this.form.zoomInput.value=this.value;ZoomChangeFunction(this.value);" />
        <input id="zoomInput" class="sliderInput" type="number" name="zoomInput" style="top:25px;left:700px;" min="1" max="600" value="360" oninput="this.value=Math.min(this.max,Math.max(this.min,this.value));this.form.zoomSlider.value=this.value;ZoomChangeFunction(this.value);"/>
      </form>
  </div>
  <div>
    <button onclick="ZoomIn();" style="position:absolute;top:30px;left:744px;font-family:Courier New">+</button>
    <button onclick="ZoomOut();" style="position:absolute;top:228px;left:744px;font-family:Courier New">-</button>
  </div>
  <div class="slidecontainer">
      <form>
        <input id="dateSlider" class="slider" type="range" name="dateSlider" min="1984" max="9999" step="0.0833333333333333333333" value="0" style="position:absolute;
    top: 620px;
    left: 68px;
    width: 704px;" oninput="this.form.dateInputY.value=Math.floor(this.value);this.form.dateInputM.value=1+Math.round(12*(this.value)%Math.floor(this.value)); DateChangeFunction(this.value);" />
        <input id="dateInputY" class="sliderInput" type="number" name="dateInputY" style="top:640px;left:400px;" min="1984" max="1" value="0" oninput="this.value=Math.min(this.max,Math.max(this.min,this.value));this.form.dateSlider.value=this.value;DateChangeFunction(this.value);"/>
        <input id="dateInputM" class="sliderInput" type="number" name="dateInputM" style="top:640px;left:450px;" min="1" max="12" value="13" oninput="this.value=Math.min(this.max,Math.max(this.min,this.value));this.form.dateSlider.value=this.value;DateChangeFunction(this.value);"/>
      </form>
  </div>
  <div>
      <form>
        <label for="cumulativeLaunchesCheck" style=" position:absolute; left:595px; top:600px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> Show Launches Cumulatively </label>
        <input type="checkbox" id="cumulativeLaunchesCheck" checked= true name="cumulativeLaunchescheck" onchange="CumulativeLaunchesChangeFunction();" style=" position:absolute; left:570px; top:598px; filter: hue-rotate(0deg) brightness(1.0) saturate(0%) contrast(2)">
    </form>
  </div>
  <div>
      <form>
        <label for="SLVCheck" style=" position:absolute; left:595px; top:580px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> SLV (Satellite Launch Vehicle)</label>
        <input type="checkbox" id="SLVCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:578px; filter: hue-rotate(0deg) brightness(1.7) saturate(0%)">
    </form>
    <form>
        <label for="SRBMCheck" style=" position:absolute; left:595px; top:560px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> SRBM (Short Range)</label>
        <input type="checkbox" id="SRBMCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:558px; filter: hue-rotate(-60deg) brightness(1.2) saturate(100%)">
    </form>
    <form>
        <label for="MRBMCheck" style=" position:absolute; left:595px; top:540px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> MRBM (Medium Range)</label>
        <input type="checkbox" id="MRBMCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:538px; filter: hue-rotate(-180deg) brightness(1.6) saturate(100%)">
    </form>
    <form>
        <label for="IRBMCheck" style=" position:absolute; left:595px; top:520px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> IRBM (Intermediate Range)</label>
        <input type="checkbox" id="IRBMCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:518px; filter: hue-rotate(-225deg) brightness(1.0) contrast(1.5) saturate(100%)">
    </form>
    <form>
        <label for="ICBMCheck" style=" position:absolute; left:595px; top:500px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> ICBM (Inter-Continental)</label>
        <input type="checkbox" id="ICBMCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:498px; filter: hue-rotate(-270deg) brightness(1.0) contrast(2) saturate(66%)">
    </form>
    <form>
        <label for="HypRangeCheck" style=" position:absolute; left:595px; top:480px; font-family: Garamond, serif; font-size: 13px; color: #00508a;"> Show Hypothetical Ranges*</label>
        <input type="checkbox" id="HypRangeCheck" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:570px; top:478px; filter: hue-rotate(-270deg) brightness(1.0) contrast(5) saturate(0%)">
    </form>
  </div>
  
  <div style="position:absolute;top:20px;left:779px;font-family: Garamond, serif; font-size: 15px; color: #252525;">
    Show Continents:
  </div>
    
  <div>
    <form>
        <label for="SelectAllContinents" style=" position:absolute; left:795px; top:40px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Select All</label>
        <input type="checkbox" id="SelectAllContinents" checked= false onchange="SelectAllContinentsFnc();" style=" position:absolute; left:775px; top:38px;">
    </form>
     <form>
        <label for="Asia" style=" position:absolute; left:795px; top:60px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Asia</label>
        <input type="checkbox" id="Asia" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:58px;">
    </form>
     <form>
        <label for="NorthAmerica" style=" position:absolute; left:795px; top:80px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">North America</label>
        <input type="checkbox" id="NorthAmerica" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:78px;">
    </form>
     <form>
        <label for="Europe" style=" position:absolute; left:795px; top:100px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Europe</label>
        <input type="checkbox" id="Europe" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:98px;">
    </form>
     <form>
        <label for="Oceania" style=" position:absolute; left:795px; top:120px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Oceania</label>
        <input type="checkbox" id="Oceania" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:118px;">
    </form>
     <form>
        <label for="Africa" style=" position:absolute; left:795px; top:140px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Africa</label>
        <input type="checkbox" id="Africa" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:138px;">
    </form>
     <form>
        <label for="SouthAmerica" style=" position:absolute; left:795px; top:160px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">South America</label>
        <input type="checkbox" id="SouthAmerica" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:158px;">
    </form>
     <form>
        <label for="Antarctica" style=" position:absolute; left:795px; top:180px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Antarctica</label>
        <input type="checkbox" id="Antarctica" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:178px;">
    </form>
  </div>
  
  <div style="position:absolute;top:200px;left:779px;font-family: Garamond, serif; font-size: 15px; color: #252525;">
    Show Countries:
  </div>
    
  <div>
    <form>
        <label for="SelectAllCountries" style=" position:absolute; left:795px; top:220px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Select All</label>
        <input type="checkbox" id="SelectAllCountries" checked= false onchange="SelectAllCountriesFnc();" style=" position:absolute; left:775px; top:218px;">
    </form>
    <form>
        <label for="Korea" style=" position:absolute; left:795px; top:240px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Korea</label>
        <input type="checkbox" id="Korea" checked= true disabled=true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:238px;">
    </form>
    <form>
        <label for="Japan" style=" position:absolute; left:795px; top:260px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Japan</label>
        <input type="checkbox" id="Japan" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:258px;">
    </form>
    <form>
        <label for="China" style=" position:absolute; left:795px; top:280px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">China</label>
        <input type="checkbox" id="China" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:278px;">
    </form>
    <form>
        <label for="Russia" style=" position:absolute; left:795px; top:300px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Russia</label>
        <input type="checkbox" id="Russia" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:298px;">
    </form>
    <form>
        <label for="Guam" style=" position:absolute; left:795px; top:320px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Guam</label>
        <input type="checkbox" id="Guam" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:318px;">
    </form>
    <form>
        <label for="Alaska" style=" position:absolute; left:795px; top:340px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Alaska</label>
        <input type="checkbox" id="Alaska" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:338px;">
    </form>
    <form>
        <label for="Canada" style=" position:absolute; left:795px; top:360px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Canada</label>
        <input type="checkbox" id="Canada" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:358px;">
    </form>
    <form>
        <label for="Hawaii" style=" position:absolute; left:795px; top:380px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Hawaii</label>
        <input type="checkbox" id="Hawaii" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:378px;">
    </form>
    <form>
        <label for="USAC" style=" position:absolute; left:795px; top:400px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">US contiguous</label>
        <input type="checkbox" id="USAC" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:398px;">
    </form>
    <form>
        <label for="India" style=" position:absolute; left:795px; top:420px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">India</label>
        <input type="checkbox" id="India" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:418px;">
    </form>
    <form>
        <label for="Germany" style=" position:absolute; left:795px; top:440px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Germany</label>
        <input type="checkbox" id="Germany" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:438px;">
    </form>
    <form>
        <label for="UK" style=" position:absolute; left:795px; top:460px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">UK</label>
        <input type="checkbox" id="UK" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:458px;">
    </form>
    <form>
        <label for="France" style=" position:absolute; left:795px; top:480px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">France</label>
        <input type="checkbox" id="France" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:478px;">
    </form>
    <form>
        <label for="Australia" style=" position:absolute; left:795px; top:500px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Australia</label>
        <input type="checkbox" id="Australia" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:498px;">
    </form>
    <form>
        <label for="Nigeria" style=" position:absolute; left:795px; top:520px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Nigeria</label>
        <input type="checkbox" id="Nigeria" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:518px;">
    </form>
    <form>
        <label for="SouthAfrica" style=" position:absolute; left:795px; top:540px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">South Africa</label>
        <input type="checkbox" id="SouthAfrica" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:538px;">
    </form>
    <form>
        <label for="Brazil" style=" position:absolute; left:795px; top:560px; font-family: Garamond, serif; font-size: 14px; color: #00508a;">Brazil</label>
        <input type="checkbox" id="Brazil" checked= true onchange="VehicleChangeFunction();" style=" position:absolute; left:775px; top:558px;">
    </form>
  </div>
<script type="text/javascript">
    /*
<video width="100px" height="100px" controls>
  <source src="https://video.wixstatic.com/video/fd208e_4386a36f54eb41b6955070aa26ff9f0c/1080p/mp4/file.mp4" type="video/mp4">
  Your browser does not support HTML video.
  
</video>
    */
console.clear();
  
  //update the date
  var today = new Date();
  var dd = String(today.getDate()).padStart(2, '0');
  var mm = Number(String(today.getMonth() + 1).padStart(2, '0'));   //January is 0!
  var yyyy = today.getFullYear();
  
  //console.log(today)
  //console.log(mm)
  //console.log(yyyy)
  dateInputM.value = mm;
  dateInputM.max = mm;
  dateInputY.value = yyyy;
  dateInputY.max = yyyy;
  dateSlider.value = yyyy+mm/12;
  dateSlider.max = yyyy+mm/12;
  
  /*
  <input id="dateSlider" class="slider" type="range" name="dateSlider" min="1984" max="2022.5833333333333333333333" step="0.0833333333333333333333" value="2022.5833333333333333333333" style="position:absolute;
    top: 620px;
    left: 68px;
    width: 704px;" oninput="this.form.dateInputY.value=Math.floor(this.value);this.form.dateInputM.value=1+Math.round(12*(this.value)%Math.floor(this.value)); DateChangeFunction(this.value);" />
  */
  HypRangeCheck.checked = false;
  
  //Initial Conditions
  SelectAllContinents.checked = false;
  Asia.checked = true;
  NorthAmerica.checked = true;
  Europe.checked = true;
  Oceania.checked = false;
  Africa.checked = true;
  SouthAmerica.checked = true;
  Antarctica.checked = false;
  
  
  function SelectAllContinentsFnc(){
      var continentssetting
      if (SelectAllContinents.checked == true){
        continentssetting = true;
      }else{
        continentssetting = false;
      }

          Asia.checked = continentssetting;
          NorthAmerica.checked = continentssetting;
          Europe.checked = continentssetting;
          Oceania.checked = continentssetting;
          Africa.checked = continentssetting;
          SouthAmerica.checked = continentssetting;
          Antarctica.checked = continentssetting;

      DrawTrajectories();
  }
  
  //Initial Conditions
  SelectAllCountries.checked = false;
  Japan.checked = true;
  China.checked = false;
  Russia.checked = false;
  Guam.checked = true;
  Alaska.checked = true;
  Canada.checked = false;
  Hawaii.checked = true;
  USAC.checked = true;
  India.checked = true;
  Germany.checked = false;
  UK.checked = true;
  France.checked = false;
  Australia.checked = false;
  Nigeria.checked = true;
  SouthAfrica.checked = false;
  Brazil.checked = true;
  
  function SelectAllCountriesFnc(){
      var countriessetting
      if (SelectAllCountries.checked == true){
        countriessetting = true;
      }else{
        countriessetting = false;
      }

          Japan.checked = countriessetting;
          China.checked = countriessetting;
          Russia.checked = countriessetting;
          Guam.checked = countriessetting;
          Alaska.checked = countriessetting;
          Canada.checked = countriessetting;
          Hawaii.checked = countriessetting;
          USAC.checked = countriessetting;
          India.checked = countriessetting;
          Germany.checked = countriessetting;
          UK.checked = countriessetting;
          France.checked = countriessetting;
          Australia.checked = countriessetting;
          Nigeria.checked = countriessetting;
          SouthAfrica.checked = countriessetting;
          Brazil.checked = countriessetting;

      DrawTrajectories();
  }
  
  let zoomPts = [0,4,20,50,100,180,360,470,575,675,775,900];
  
  function ZoomIn(){
      if (Number(zoomSlider.value) < math.max(zoomPts)){
          var current = Number(zoomSlider.value);
          var nextval = zoomPts.find(element => {return element > current;});
          //console.log(nextval)
          var idx = zoomPts.indexOf(nextval);
          
          zoomSlider.value = zoomPts[idx];
          zoomInput.value = zoomPts[idx];
          DrawTrajectories();
      }
  }
  
  function ZoomOut(){
      if (Number(zoomSlider.value) > math.min(zoomPts)){
          var current = Number(zoomSlider.value);
          var nextval = zoomPts.reverse().find(element => {return element < current;});
          //console.log(nextval)
          var idx = zoomPts.reverse().indexOf(nextval);
            zoomSlider.value = zoomPts[idx];
            zoomInput.value = zoomPts[idx];
          DrawTrajectories();
      }
  }
  
  //%launchdata
//%SUCCESSFUL LAUNCHES ONLY

//%type guide: 0 - SLV, 1 - SRBM, 2 - MRBM, 3 - IRBM, 4 - ICBM
//%               grey?    green?     orange?   red?     purple?
//All distances in km
//%[apogee, arc dist, type, predict?, year, month, day, no. of missiles]
let launchdata = [
  [0,0,1,0,1984,4,9,1,3,],[0,0,1,0,1984,4,9,1,4,],[200,0,1,0,1984,4,9,1,5,],[0,0,1,0,1984,9,1,0,6,],[200,0,1,0,1984,9,1,0,7,],[200,0,1,0,1984,9,1,0,8,],[200,0,1,0,1990,6,1,1,11,],[0,0,1,0,1991,7,1,1,12,],[150,500,2,0,1993,5,29,1,14,],[200,0,1,0,1993,5,29,0,15,],[200,0,1,0,1993,5,29,1,16,],[200,0,1,0,1993,5,30,1,17,],[0,1380,0,0,1998,8,31,0,18,],[40,0,0,0,2006,7,5,0,19,],[150,0,1,0,2006,7,5,1,20,],[150,0,2,0,2006,7,5,1,21,],[150,0,1,0,2006,7,5,1,22,],[150,0,2,0,2006,7,5,1,23,],[150,0,2,0,2006,7,5,1,24,],[150,0,2,0,2006,7,5,1,25,],[0,0,0,0,2009,4,5,0,26,],[150,0,2,0,2009,7,5,1,27,],[150,0,2,0,2009,7,5,1,28,],[0,0,1,0,2009,7,5,1,29,],[0,0,1,0,2009,7,5,1,30,],[0,0,1,0,2009,7,5,1,31,],[0,0,1,0,2009,7,5,1,32,],[0,0,1,0,2009,7,5,1,33,],[0,0,0,0,2012,4,13,0,34,],[581,0,0,0,2012,12,12,1,35,],[80,200,1,0,2014,2,27,1,42,],[0,200,1,0,2014,2,27,1,43,],[0,200,1,0,2014,2,27,1,44,],[0,200,1,0,2014,2,27,1,45,],[150,500,1,0,2014,3,3,1,46,],[0,500,1,0,2014,3,3,1,47,],[150,650,2,0,2014,3,26,1,48,],[150,650,2,0,2014,3,26,1,49,],[0,0,1,0,2014,6,26,1,50,],[150,0,1,0,2014,6,29,1,51,],[150,0,1,0,2014,6,29,1,52,],[100,500,1,0,2014,7,9,1,53,],[100,500,1,0,2014,7,9,1,54,],[120,500,1,0,2014,7,13,1,55,],[120,500,1,0,2014,7,13,1,56,],[0,500,1,0,2014,7,26,1,57,],[0,0,1,0,2014,8,14,1,58,],[0,0,1,0,2014,9,1,1,59,],[0,0,1,0,2014,9,6,1,60,],[0,0,1,0,2015,2,8,1,61,],[0,0,1,0,2015,2,8,1,62,],[0,0,1,0,2015,2,8,1,63,],[0,0,1,0,2015,2,8,1,64,],[0,0,1,0,2015,2,8,1,65,],[134,490,1,0,2015,3,1,1,66,],[134,490,1,0,2015,3,1,1,67,],[0,0,1,0,2015,4,2,1,68,],[0,0,1,0,2015,4,3,1,69,],[0,0,1,0,2015,4,3,1,70,],[0,0,1,0,2015,4,3,1,71,],[0,0,1,0,2015,4,3,1,72,],[0,0,1,0,2015,5,8,1,73,],[0,0,1,0,2015,11,28,0,74,],[0,0,1,0,2015,12,21,0,75,],[502,0,0,0,2016,2,7,1,76,],[0,0,1,0,2016,3,10,1,77,],[0,0,1,0,2016,3,10,1,78,],[0,800,2,0,2016,3,18,1,79,],[17,0,2,0,2016,3,18,0,80,],[0,0,3,0,2016,4,15,0,81,],[0,30,1,0,2016,4,23,1,82,],[0,0,3,0,2016,4,27,0,83,],[0,0,3,0,2016,4,28,0,84,],[0,0,3,0,2016,5,30,0,85,],[0,0,3,0,2016,6,21,0,86,],[1400,400,3,0,2016,6,21,1,87,],[10,0,1,0,2016,7,9,0,88,],[0,0,1,0,2016,7,18,1,89,],[0,0,1,0,2016,7,18,1,90,],[0,500,2,0,2016,7,18,1,91,],[0,1000,2,0,2016,8,2,1,92,],[0,0,2,0,2016,8,2,0,93,],[0,500,1,0,2016,8,23,1,94,],[0,1000,2,0,2016,9,5,1,95,],[0,1000,2,0,2016,9,5,1,96,],[0,1000,2,0,2016,9,5,1,97,],[0,0,3,0,2016,10,14,0,98,],[0,0,3,0,2016,10,19,0,99,],[550,500,2,0,2017,2,11,1,100,],[260,1000,2,0,2017,3,5,1,101,],[260,1000,2,0,2017,3,5,1,102,],[260,1000,2,0,2017,3,5,1,103,],[260,1000,2,0,2017,3,5,1,104,],[0,0,2,0,2017,3,5,0,105,],[189,60,3,0,2017,4,4,0,107,],[0,0,3,0,2017,4,15,0,108,],[71,0,3,0,2017,4,28,0,109,],[2111.5,787,3,0,2017,5,14,1,110,],[560,500,2,0,2017,5,21,1,111,],[120,400,1,0,2017,5,28,1,112,],[2802,933,4,0,2017,7,4,1,113,],[3724.9,998,4,0,2017,7,28,1,114,],[0,250,1,0,2017,8,25,1,115,],[0,0,1,0,2017,8,25,0,116,],[0,250,1,0,2017,8,25,1,117,],[550,2700,3,0,2017,8,28,0,118,],[770,3700,3,0,2017,9,14,1,119,],[4475,950,4,0,2017,11,28,1,120,],[0,0,1,0,2019,4,17,1,121,],[0,200,1,0,2019,5,4,1,122,],[0,0,1,0,2019,5,4,1,123,],[50,420,1,0,2019,5,9,1,124,],[0,0,1,0,2019,5,9,1,125,],[50,430,1,0,2019,7,24,1,126,],[50,690,1,0,2019,7,24,1,127,],[25,220,1,0,2019,8,1,1,130,],[25,220,1,0,2019,8,1,1,131,],[37,450,1,0,2019,8,5,1,132,],[37,450,1,0,2019,8,5,1,133,],[48,400,1,0,2019,8,9,1,134,],[48,400,1,0,2019,8,9,1,135,],[30,230,1,0,2019,8,15,1,136,],[30,230,1,0,2019,8,15,1,137,],[97,380,1,0,2019,8,23,1,138,],[97,380,1,0,2019,8,23,1,139,],[50,330,1,0,2019,9,9,1,140,],[50,330,1,0,2019,9,9,1,141,],[0,0,1,0,2019,9,9,0,142,],[910,450,1,0,2019,10,1,1,143,],[90,370,1,0,2019,10,31,1,144,],[90,370,1,0,2019,10,31,1,145,],[97,380,1,0,2019,11,28,1,146,],[97,380,1,0,2019,11,28,1,147,],[35,240,1,0,2020,3,2,1,148,],[35,240,1,0,2020,3,2,1,149,],[50,200,1,0,2020,3,8,1,150,],[50,200,1,0,2020,3,8,1,151,],[50,200,1,0,2020,3,8,1,152,],[50,410,1,0,2020,3,20,1,153,],[50,410,1,0,2020,3,20,1,154,],[30,230,1,0,2020,3,28,1,155,],[30,230,1,0,2020,3,28,1,156,],[60,450,1,0,2021,3,24,1,157,],[60,450,1,0,2021,3,24,1,158,],[60,800,1,0,2021,9,15,1,159,],[60,800,1,0,2021,9,15,1,160,],[60,200,3,0,2021,9,27,1,161,],[60,590,1,0,2021,10,19,1,162,],[30,700,2,0,2022,1,5,1,163,],[60,1000,2,0,2022,1,10,1,164,],[36,430,1,0,2022,1,14,1,165,],[36,430,1,0,2022,1,14,1,166,],[42,380,1,0,2022,1,16,1,167,],[42,380,1,0,2022,1,16,1,168,],[20,190,1,0,2022,1,26,1,169,],[20,190,1,0,2022,1,26,1,170,],[2000,800,3,0,2022,1,29,1,171,],[6248,1090,4,0,2022,3,24,1,175,],[25,110,1,0,2022,4,16,1,176,],[25,110,1,0,2022,4,16,1,177,],[780,470,4,0,2022,5,4,0,178,],[60,600,1,0,2022,5,7,0,179,],[90,360,1,0,2022,5,12,0,180,],[90,360,1,0,2022,5,12,0,181,],[90,360,1,0,2022,5,12,0,182,],[60,760,1,0,2022,5,24,1,185,],[50,350,1,0,2022,6,5,0,186,],[50,300,1,0,2022,6,5,0,187,],[50,400,1,0,2022,6,5,0,188,],[90,670,1,0,2022,6,5,0,189,],[100,350,1,0,2022,6,5,0,190,],[50,400,1,0,2022,6,5,0,191,],[90,670,1,0,2022,6,5,0,192,],[100,300,1,0,2022,6,5,0,193,],[60,600,1,0,2022,9,24,1,194,],[50,350,1,0,2022,9,28,1,195,],[50,300,1,0,2022,9,28,1,196,],[50,350,1,0,2022,9,29,1,197,],[50,300,1,0,2022,9,29,1,198,],[50,400,1,0,2022,9,30,1,199,],[50,350,1,0,2022,9,30,1,200,],[970,4500,3,0,2022,10,3,1,201,],[100,350,1,0,2022,10,5,1,202,],[50,800,1,0,2022,10,5,1,203,],[90,350,1,0,2022,10,8,1,204,],[90,350,1,0,2022,10,8,1,205,],[50,700,1,0,2022,10,13,0,206,],[24,230,1,0,2022,10,28,0,207,],[24,230,1,0,2022,10,28,0,208,],[0,0,1,0,2022,11,1,1,209,],[0,0,1,0,2022,11,1,1,210,],[0,0,1,0,2022,11,1,1,211,],[0,0,1,0,2022,11,1,1,212,],[100,200,1,0,2022,11,1,0,213,],[150,150,1,0,2022,11,1,0,214,],[150,150,1,0,2022,11,1,0,215,],[1920,760,4,0,2022,11,2,0,216,],[70,330,1,0,2022,11,2,1,217,],[70,330,1,0,2022,11,2,1,218,],[130,490,1,0,2022,11,3,1,219,],[130,490,1,0,2022,11,3,1,220,],[130,490,1,0,2022,11,3,1,221,],[30,290,1,0,2022,11,9,0,222,],[47,240,1,0,2022,11,17,0,223,],[6100,1000,4,0,2022,11,18,1,224,],
    ];
//%[apogee, arc dist, type, predict?, year, month, day, success/fail/unknown, excelID]
//console.log(launchdata.length)
//%check for unknown apogee/distancetravelled (0)
var knClean = 0;
var knCorrections = 0;

for (i = 0; i < launchdata.length; i++) {//launchdata.length
//for i = 1:1:length(launchdata)
    if (launchdata[i][0] == 0 && launchdata[i][1] == 0){
        launchdata[i][0] = 30+25*Math.random();
        launchdata[i][1] = 50+50*Math.random();
        knCorrections = knCorrections + 1;
    }else if (launchdata[i][0] == 0 || launchdata[i][1] == 0){
        if (launchdata[i][0] == 0){
            launchdata[i][0] = 0.25*launchdata[i][1]+(0.5*Math.random()-0.25)*launchdata[i][0];
        }else{
            launchdata[i][1] = launchdata[i][0]+(0.25*Math.random()-1/8)*launchdata[i][0];
        }
        knCorrections = knCorrections + 1;
    }else{
        knClean = knClean + 1;
    }
  }
  
//%% Trajectory calculation
var ER = 6371; //%earth radius
var dx = 4; // delta x spread. 0.5 = ~20k pts. 2 = ~5000pts.
var apogee
var arc

var xTrajectory = new Array(launchdata.length).fill(NaN).map(() => new Array(2).fill(NaN));
var yTrajectory = new Array(launchdata.length).fill(NaN).map(() => new Array(2).fill(NaN));
var hypxTrajectory = new Array(launchdata.length).fill(NaN).map(() => new Array(2).fill(NaN));
var hypyTrajectory = new Array(launchdata.length).fill(NaN).map(() => new Array(2).fill(NaN));
  
for (i = 0; i < launchdata.length; i++) { //launchdata.length
    apogee = launchdata[i][0]; //%altitude reached
    arc = launchdata[i][1];    //%ground distance
    
    xyRotated = generateTrajectory(apogee,arc,dx);
  
    if (!isNaN(launchdata[i][9])){
      hypxyRotated = generateTrajectory(Math.max(apogee*arc/launchdata[i][9],apogee/3),launchdata[i][9],dx/2); //
    }
    //var xRotated = xyRotated[][0];//(:,1);
    //var yRotated = xyRotated[][1];//(:,2);
    
    //%store trajectory in cartesian matrix:
    
    for (j = 0; j < xyRotated.length; j++) {
        xTrajectory[i][j] = xyRotated[j][0];//xRotated(j);
        yTrajectory[i][j] = xyRotated[j][1];//yRotated(j);
    }
    if (!isNaN(launchdata[i][9])){
      for (j = 0; j < hypxyRotated.length; j++) {
          hypxTrajectory[i][j] = hypxyRotated[j][0];//xRotated(j);
          hypyTrajectory[i][j] = hypxyRotated[j][1];//yRotated(j);
      }
    }
    
}
 
 function generateTrajectory(apogee,arc,dx){
   var centerAngle
  var Angle
  var chord
  var sagitta
    centerAngle = -0.5*(arc/(Math.PI*ER))*180; //%angle between apex & launch (deg)
    Angle = centerAngle*Math.PI/180; //%convert back to radians
    chord = -2*ER*Math.sin(Angle); //%(full) minor axis length
    sagitta = ER-Math.sqrt(Math.pow(ER,2)-Math.pow((chord/2),2)); //%dist from earth surface to chord midpoint
    
    var x1=[0,0];                   //%first point of parabola
    var x2=[chord/2,(apogee+sagitta)];//%parabola apex point
    var x3=[chord,0];               //%last point of parabola
    var y = math.matrix([[x1[1]], [x2[1]], [x3[1]]]);//y=[x1(2);x2(2);x3(2)];
    var A = math.matrix([
                        [Math.pow(x1[0],2),x1[0],1],
                        [Math.pow(x2[0],2),x2[0],1],
                        [Math.pow(x3[0],2),x3[0],1],
                        ]);//A=[x1(1)^2 x1(1) 1;x2(1)^2 x2(1) 1;x3(1)^2 x3(1) 1];
    var X=math.multiply(math.inv(A),y);
  
    //var x = x1(1):0.5:x3(1);
    var x = [];
    for (var j = x1[0]; j <= x3[0]; j+= dx) {
       x.push(j);
    }
    //var y = X(1)*x.^2+X(2)*x+ER;
    var y = new Array(x.length).fill(0);
    for (var j = 0; j< x.length; j++){
      y[j] = X._data[0]*Math.pow(x[j],2)+X._data[1]*x[j]+ER;
    }

    //% point to rotate about: [0,6371];
    var xc = 0;
    var yc = ER;
    //%transform matrix: rotate about arbitrary point:
    var M = [
        [Math.cos(Angle), Math.sin(Angle), 0],//;...
        [-Math.sin(Angle), Math.cos(Angle), 0],//;...
        [-xc*Math.cos(Angle)+yc*Math.sin(Angle)+xc, -xc*Math.sin(Angle)-yc*Math.cos(Angle)+yc, 1],//;
        ];//

    //xyAligned = [x;y;ones(1,length(x))]';
    var onearray = new Array(x.length).fill(1);
  
  
    var xyAligned = math.ctranspose(math.concat([x],[y],[onearray],0));
  
    var xyRotated = math.multiply(xyAligned,M)
  
    return xyRotated;
 }
  
  
 let ldata = launchdata;
 let xt = xTrajectory;
 let yt = yTrajectory;
 let hypxt = hypxTrajectory;
 let hypyt = hypyTrajectory;
 
 DrawTrajectories();
  
  function ZoomChangeFunction(val){
    let zoomval = val;//-val+100;
    DrawTrajectories();
  }
  function DateChangeFunction(val){
    let dateval = val;//-val+100;
    DrawTrajectories();
  }
  function CumulativeLaunchesChangeFunction(val){
    let cumval = val;//-val+100;
    DrawTrajectories();
  }
  function VehicleChangeFunction(){
    DrawTrajectories();
  }
  
  
  function DrawTrajectories(){
    
    let zoomcase = Number(zoomSlider.value);
    let dateSelectY = Number(dateInputY.value);
    let dateSelectM = Number(dateInputM.value);
    
    let cumulativeCheck = cumulativeLaunchesCheck.checked;
    let ICBMcheck = ICBMCheck.checked;
    let IRBMcheck = IRBMCheck.checked;
    let MRBMcheck = MRBMCheck.checked;
    let SRBMcheck = SRBMCheck.checked;
    let SLVcheck  = SLVCheck.checked;
    
    //ldata,xt,yt,zoomcase)
    var canvas = document.getElementById('TrajCanvas');
    var context = canvas.getContext('2d');
    
    var xsize = 700;
    var ysize = 600;
    canvas.style.width = xsize + "px";
    canvas.style.height = ysize + "px";

    // Set actual size in memory (scaled to account for extra pixel density).
    var scale = 2;//window.devicePixelRatio; // Change to 1 on retina screens to see blurry canvas.
    canvas.width = Math.floor(xsize * scale);
    canvas.height = Math.floor(ysize * scale);


    // Normalize coordinate system to use css pixels.
    context.scale(scale, scale);
    
    context.clearRect(0, 0, canvas.width/scale, canvas.height/scale);
    //console.log('trajectory matrix size:')
    //console.log(xt.length)
    //console.log(xt[0].length)
    
    ER = 6371;
    MR = 1737;
    E2M = 384400;
    
    //let zoomcase = 1;
    //0 = Earth+Moon
    //1 = WholeEarth
    //2 = ImportantCountries (original)
    //3 = East Asia
    //4 = Korea
    //5 = Atmosphere
    
  let zoomid = [];
  let cxid = [];
  let cyid = [];
  for (zoomcasei = 0; zoomcasei <= 5; zoomcasei++) {
    if (zoomcasei == 0){
    //Earth+Moon/GeostationaryOrbit?
    zoomid.push(0.0015);
    cxid.push(canvas.width*0.0225/scale);
    cyid.push(canvas.height*0.975/scale);
    }else if (zoomcasei == 1){
    //WholeEarth
    zoomid.push(0.03);
    cxid.push(canvas.width*0.35/scale);
    cyid.push(canvas.height*0.65/scale);
    }else if (zoomcasei == 2){
    //ImportantCountries (Original View)
    zoomid.push(0.04);
    cxid.push(canvas.width*0.125/scale);
    cyid.push(canvas.height*0.9/scale);
    }else if (zoomcasei == 3){
    //Just East Asia
    zoomid.push(0.2);
    cxid.push(canvas.width*0.125/scale);
    cyid.push(canvas.height*2.5/scale);
    }else if (zoomcasei == 4){
    //Korea
    zoomid.push(0.75);
    cxid.push(canvas.width*0.125/scale);
    cyid.push(canvas.height*8.5/scale);
    }else if (zoomcasei == 5){
    //Atmosphere
    zoomid.push(3);
    cxid.push(canvas.width*0.125/scale);
    cyid.push(canvas.height*32.6/scale);
    }
  }
  
  zoomid = interpolateArray(zoomid,Number(zoomSlider.max)+1)
  cxid = interpolateArray(cxid, Number(zoomSlider.max)+1)
  cyid = interpolateArray(cyid, Number(zoomSlider.max)+1)
    
  let zoom = zoomid[zoomcase];
  let cx = cxid[zoomcase];
  let cy = cyid[zoomcase];
    

    //Measurement Rings
    var ringAlt
    var ringLabel
      let rings = [0.2,0.5,1,2,3,4,5,10,20,'GEO',50,100,200,300,'MOON',500];
    context.save();
      context.translate(cx, cy);
        context.rotate(45*Math.PI/180)
      for (i = 0; i < rings.length; i++){
        
        if (typeof(rings[i]) == 'string'){
            context.font = "bold 12px Helvetica";
            if (rings[i] == 'GEO'){
              ringAlt = 35.786;
              ringLabel = 'Geostationary Orbit';
            }else if (rings[i] == 'MOON'){
              ringAlt = (E2M-ER)/1000;
              ringLabel = 'The Moon'
            }
        }else{
            context.font = "12px Helvetica";
            ringAlt = rings[i];
            ringLabel = (rings[i]*1000).toString()+' km';
        }
        
        context.moveTo(0,-(ER+ringAlt*1000)*zoom);
        context.beginPath();
        context.lineJoin = "round";
        context.ellipse(0, 0, (ER+ringAlt*1000)*zoom, (ER+ringAlt*1000)*zoom, 0, 0, 2*Math.PI)
        context.strokeStyle = 'rgb('+math.multiply([0.9,0.9,0.9],255)+')';
        context.lineWidth = 1;
        //context.setLineDash([2,2]);
        context.stroke();
        context.closePath();
        context.textAlign = "center";
        context.fillStyle = 'rgb('+math.multiply([0.7,0.7,0.7],255)+')';
        context.fillText(ringLabel,0*(ER+ringAlt*1000)*zoom,-(ER+ringAlt*1000)*zoom)
      }
    context.restore();
    
          //Atmosphere
      context.moveTo(cx,cy-(ER+100)*zoom);
      context.beginPath();
      context.lineJoin = "round";
      context.ellipse(cx, cy, (ER+100)*zoom, (ER+100)*zoom, 0, 0, 2*Math.PI)
      context.strokeStyle = 'rgb('+math.multiply([0.0,0.9,0.9],255)+')';
      context.lineWidth = 1;
      context.stroke();
      context.closePath();
    
      //Moon
      if (Number(zoomSlider.value) < 20){
        context.moveTo(cx,cy-ER*zoom);
        context.beginPath();
        context.lineJoin = "round";
        context.ellipse(cx+(E2M*Math.cos(40*Math.PI/180))*zoom, cy-(E2M*Math.sin(40*Math.PI/180))*zoom, MR*zoom, MR*zoom, 0, 0, 2*Math.PI)
        context.strokeStyle = 'rgb('+math.multiply([0.5,0.5,0.5],255)+')';
        context.fillStyle = context.strokeStyle;
        context.lineWidth = 1;
        context.stroke();
        context.fill();
        context.closePath();
      }
    
    //LandMasses     NAME,ArcW,ArcE,level,labelcolor
    //,'DMZ-1',135,'DMZ-2',160
    var LandMasses
      if (zoomSlider.value >= 566){
        LandMasses = [
          ['Korea',246.5,246.5,0,1],
          ['North Korea',-157,560,0,1,'Pyongyang',0],
          ['South Korea', 150,650,0,1,'Seoul',194.71],
        ];
          if (zoomSlider.value >= 650){
            LandMasses.push(['DMZ',135,160,0,1]);
          }
      }else{
      LandMasses = [                   ['Korea',-157,650,0,1,'Pyongyang',0],
        ];
        if (zoomSlider.value >= 425){ LandMasses.push(['',0,0,0,1,'Seoul',194.71]);
         }
      }
    
    //CONTINENTS
    
      if (Asia.checked == true){
LandMasses.push(['Asia',-8420,5360,1,1]);
      }
      if (NorthAmerica.checked == true){
LandMasses.push(['N.America',5000,14200,1,1]);
      }
      if (Europe.checked == true){
LandMasses.push(['Europe',-4800,-10375,1,1]);
      }
      if (Oceania.checked == true){
LandMasses.push(['Oceania (W)',-5930,-8234,1,1]);
LandMasses.push(['Oceania (E)',4900,10740,1,1]);
      }
      if (Africa.checked == true){
LandMasses.push(['Africa',-8000,-13700,1,1]);
      }
      if (SouthAmerica.checked == true){
LandMasses.push(['S.America',14000,19800,1,1]);
      }
      if (Antarctica.checked == true){
LandMasses.push(['Antarctica',-11600,-17300,1,1]);
      }
    
    // COUNTRIES
    
      if (Japan.checked == true){
LandMasses.push(['Japan',685,1720,0,1,'Tokyo',801.55]);
      }
      if (China.checked == true){
LandMasses.push(['China (W)',-4400,-169,0,1,'Beijing',-809.87]);
        LandMasses.push(['China (E)',196,1250,0,1]);
      }
      if (Russia.checked == true){
LandMasses.push(['Russia (W)',-6900,-1330,0,1,'Moscow',-6413]);
        LandMasses.push(['Russia (E)',580,4950,0,1]);
      }
      if (Guam.checked == true){
LandMasses.push(['Guam',3388,3420,0,0,'Hagåtña',3398.73]);
      }
      if (Alaska.checked == true){
LandMasses.push(['Alaska',5000,7100,0,1,'Anchorage',5997.60]);
      }
      if (Hawaii.checked == true){
LandMasses.push(['Hawaii',7180,7770,0,1,'Honolulu',7391.77]);
      }
      if (USAC.checked == true){
LandMasses.push(['USA (Cont.)',8090,12380,0,1,'San Francisco',9000.47,'Seattle',8267,'Washington DC',11045.84,'Miami',12326.00]);
      }
      if (Canada.checked == true){
LandMasses.push(['Canada',6100,10777,0,1,'Toronto',10480]);
      }
      if (India.checked == true){
LandMasses.push(['India',-2800,-5900,0,1,'New Delhi',-4573.22]);
      }
      if (Germany.checked == true){
LandMasses.push(['Germany',-8600,-7770,0,1,'Berlin',-7920]);
      }
      if (UK.checked == true){
LandMasses.push(['UK',-7900,-9035,0,1,'London',-8664.21]);
      }
      if (France.checked == true){
LandMasses.push(['France',-8470,-9437,0,1,'Paris',-8770]);
      }
      if (Australia.checked == true){
LandMasses.push(['Australia',5623,9447,0,1,'Canberra',8604.18]);
      }
      if (Nigeria.checked == true){
LandMasses.push(['Nigeria',-12290,-10870,0,1,'Lagos',-12210]);
      }
      if (SouthAfrica.checked == true){
LandMasses.push(['S.Africa',-11918,-13680,0,1,'Cape Town',-13668.03]);
      }
      if (Brazil.checked == true){
LandMasses.push(['Brazil',15000,19400,0,1,'São Paulo',18150.69]);
      }
    
                    //Argentina?
                    //Egypt?
                    //*/
                    //];
    let maxlevel = 2.5;
    for (i = 0; i < LandMasses.length; i++){
      let LMRtop = 1-1*LandMasses[i][3]/maxlevel;
      let LMRbot = 1+0.01-1*(LandMasses[i][3]+1)/maxlevel;
      context.moveTo(cx,cy)
      context.beginPath();
      context.lineJoin = "round";
      //context.lineTo(cx,cy)
      context.lineTo(cx-ER*zoom*Math.cos(LandMasses[i][1]/ER+Math.PI/2),cy-ER*zoom*Math.sin(LandMasses[i][1]/ER+Math.PI/2));
      context.ellipse(cx,cy,ER*LMRtop*zoom,ER*LMRtop*zoom,-Math.PI/2,
              LandMasses[i][1]/ER,
              LandMasses[i][2]/ER,
              LandMasses[i][1]>LandMasses[i][2]);
      //context.lineTo(cx,cy)
      context.ellipse(cx,cy,ER*LMRbot*zoom,ER*LMRbot*zoom,-Math.PI/2,
              LandMasses[i][2]/ER,
              LandMasses[i][1]/ER,
              !(LandMasses[i][1]>LandMasses[i][2]));
      context.globalAlpha = 0.45;
      if (LandMasses[i][0] == 'DMZ'){
        context.fillStyle = '#757575';
      }else{
        context.fillStyle = '#328a20';
      }
      context.closePath();
      context.fill();
      //context.strokeStyle = '#00508a';
      //context.stroke();
      context.globalAlpha = 1;
    }
    //landmass labels
    for (i = 0; i < LandMasses.length; i++){
      let LMRtop = 1-1*LandMasses[i][3]/maxlevel;
      let LMRbot = 1+0.025-1*(LandMasses[i][3]+1)/maxlevel;
      context.save();
      context.translate(cx, cy);
      if (LandMasses[i][0] == 'North Korea'){
            let midangle = 0+Math.PI/2;
            context.fillStyle = '#ffffff';
            context.font = "bold "+Math.min(12*0.1*zoom*265,18)+"px Helvetica";
            context.textAlign = "center";
            context.fillText('North',0,-(ER-Math.min(200/zoom,2000))*zoom);
            context.fillText('Korea',0,-(ER-Math.min(220/zoom,2000))*zoom);
      }else if (LandMasses[i][0] == 'South Korea'){
            let midangle = 5*Math.PI/180+Math.PI/2;
            context.fillStyle = '#ffffff';
            context.font = "bold "+Math.min(12*0.1*zoom*265,18)+"px Helvetica";
            context.textAlign = "center";
            context.fillText('South',ER*0.038*zoom,-(ER-Math.min(200/zoom,2000))*zoom);
            context.fillText('Korea',ER*0.038*zoom,-(ER-Math.min(220/zoom,2000))*zoom);
        }else if (LandMasses[i][0] == 'DMZ'){
            let midangle = ((LandMasses[i][1]+LandMasses[i][2])/2)/ER+Math.PI/2;
            context.fillStyle = '#ffffff';
            context.font = "bold "+Math.min(12*0.1*zoom*265,18)+"px Helvetica";
            context.textAlign = "right";              context.rotate(midangle+Math.PI+Math.max(0.5/(zoom*9),0.02)*Math.PI/180);
            context.fillText('DMZ',(ER-Math.min(25/zoom,300))*zoom,0);
      }else{
          if (LandMasses[i][4] == 0){
            context.fillStyle = '#e7e7e7';
          }else{
            context.fillStyle = '#ffffff';
          }
          context.font = "bold "+15*0.1*zoom*265+"px Helvetica";
          //console.log(15*zoomSlider.value/275)
          let midangle = ((LandMasses[i][1]+LandMasses[i][2])/2)/ER+Math.PI/2;
          //console.log(midangle*180/Math.PI)
          if (midangle > Math.PI/2 && midangle < 3*Math.PI/2){
            context.rotate(midangle+Math.PI+LandMasses[i][4]*2*Math.PI/180);
            context.textAlign = "left";
            context.fillText(LandMasses[i][0],ER*LMRbot*zoom,0);
          }else{
            context.rotate(midangle-LandMasses[i][4]*2*Math.PI/180)
            context.textAlign = "right";
          context.fillText(LandMasses[i][0],-ER*LMRbot*zoom,0);
          }
    }
      context.restore();
    }
    
    //Cities
    for (i = 0; i < LandMasses.length; i++){
      for (j = 5; j < LandMasses[i].length; j+=2){
      context.moveTo(cx-ER*zoom*Math.cos(LandMasses[i][j+1]/ER+Math.PI/2),cy-ER*zoom*Math.sin(LandMasses[i][j+1]/ER+Math.PI/2))
      context.beginPath();
      context.lineJoin = "round";
      context.lineTo(cx-ER*zoom*Math.cos((0.1/zoom)*0.3*Math.PI/180+LandMasses[i][j+1]/ER+Math.PI/2),cy-ER*zoom*Math.sin((0.1/zoom)*0.3*Math.PI/180+LandMasses[i][j+1]/ER+Math.PI/2))
      context.lineTo(cx-ER*zoom*Math.cos((0.1/zoom)*-0.3*Math.PI/180+LandMasses[i][j+1]/ER+Math.PI/2),cy-ER*zoom*Math.sin((0.1/zoom)*-0.3*Math.PI/180+LandMasses[i][j+1]/ER+Math.PI/2))
      context.lineTo(cx-(ER-Math.min(30/zoom,300))*zoom*Math.cos(LandMasses[i][j+1]/ER+Math.PI/2),cy-(ER-Math.min(30/zoom,300))*zoom*Math.sin(LandMasses[i][j+1]/ER+Math.PI/2))
      
      //context.lineTo(cx,cy)
      if (LandMasses[i][j] == 'Pyongyang'){
        context.fillStyle = '#ff0000';
        context.strokeStyle = '#000000';
      }else{
        context.fillStyle = '#000000';
        context.strokeStyle = '#ffffff';
      }
      context.closePath();
      context.fill();
      context.stroke();
      }
    }
    //city labels
    for (i = 0; i < LandMasses.length; i++){
      for (j = 5; j < LandMasses[i].length; j+=2){
      let LMRtop = 1.33-1*LandMasses[i][3]/maxlevel;
      let LMRbot = 1.33+0.025-1*(LandMasses[i][3]+1)/maxlevel;
      context.save();
      context.translate(cx, cy);
      context.fillStyle = '#000000';
      if (zoomSlider.value >=360){
      context.font = "bold "+Math.min(9*0.1*zoom*265,15)+"px Helvetica"; //0.1*zoom*265
      }else{
      context.font = "bold "+9*0.1*zoom*265+"px Helvetica";
      }
      //console.log(15*zoomSlider.value/275)
      let midangle = LandMasses[i][j+1]/ER+Math.PI/2;//((LandMasses[i][1]+LandMasses[i][2])/2)/ER+Math.PI/2;
      //console.log(midangle*180/Math.PI)
      if (midangle >= Math.PI/2 && midangle < 3*Math.PI/2){
        context.rotate(midangle+Math.PI+Math.max(0.5/(zoom*17),0.014)*Math.PI/180); //
        context.textAlign = "right";
        context.fillText(LandMasses[i][j],(ER-Math.min(40/zoom,300))*zoom,0); //ER*LMRbot*zoom
      }else{
        context.rotate(midangle-Math.max(0.5/(zoom*17),0.014)*Math.PI/180) //-LandMasses[i][4]*2*Math.PI/180
        context.textAlign = "left";
      context.fillText(LandMasses[i][j],-(ER-Math.min(40/zoom,300))*zoom,0); //-ER*LMRbot*zoom
      }
      context.restore();
      }
    }
    
      //Earth surface
      context.moveTo(cx,cy-ER*zoom);
      context.beginPath();
      context.lineJoin = "round";
      context.ellipse(cx, cy, ER*zoom, ER*zoom, 0, 0, 2*Math.PI)
      context.strokeStyle = 'rgb('+math.multiply([0.0,0.0,0.0],255)+')';
      context.lineWidth = 2;
      context.stroke();
      context.closePath();
      /*
      //Earth whitespace
      context.moveTo(cx,cy-ER*0.5*zoom);
      context.beginPath();
      context.lineJoin = "round";
      context.ellipse(cx, cy, ER*0.5*zoom, ER*0.5*zoom, 0, 0, 2*Math.PI)
      context.fillStyle = '#ffffff';
      context.lineWidth = 2;
      context.fill();
      context.closePath();
    /*
      */
    //Plot Trajectories
    for (i = 0; i < xt.length; i++) {
      var PlotValid = false;
      if ((ldata[i][4]+ldata[i][5]/12 <= dateSelectY+dateSelectM/12 && cumulativeCheck == true) || (ldata[i][4] == dateSelectY && ldata[i][5] == dateSelectM)){
      context.lineWidth = 1;
      context.beginPath();
      context.lineJoin = "round";
      context.moveTo(cx,cy-ER*zoom);
      if (HypRangeCheck.checked == false || isNaN(hypxt[i][0])){
      for (j = 0; j < xt[i].length; j++) {
        context.lineTo(cx+xt[i][j]*zoom,cy-yt[i][j]*zoom);
      }
      context.lineTo(cx-ER*zoom*Math.cos(ldata[i][1]/ER+Math.PI/2),cy-ER*zoom*Math.sin(ldata[i][1]/ER+Math.PI/2));
      }else{
      for (j = 0; j < hypxt[i].length; j++) {
        context.lineTo(cx+(hypxt[i][j])*zoom,cy-hypyt[i][j]*zoom);
      }
      context.lineTo(cx-ER*zoom*Math.cos(ldata[i][9]/ER+Math.PI/2),cy-ER*zoom*Math.sin(ldata[i][9]/ER+Math.PI/2));
        
      }
      if (ldata[i][2] == 0 && SLVcheck == true){ //SLV
      PlotValid = true;
      context.strokeStyle = 'rgb('+math.multiply([0.7,0.7,0.7],255)+')';
      //------------------------------------
      } else if (ldata[i][2] == 1 && SRBMcheck == true){ //SRBM
      PlotValid = true;
      context.strokeStyle = 'rgb('+math.multiply([0.2,0.7,0.4],255)+')';
      //------------------------------------
      } else if (ldata[i][2] == 2 && MRBMcheck == true){ //MRBM
      PlotValid = true;
      context.strokeStyle = 'rgb('+math.multiply([1.0,0.6,0.0],255)+')';
      //------------------------------------
      } else if (ldata[i][2] == 3 && IRBMcheck == true){ //IRBM
      PlotValid = true;
      context.strokeStyle = 'rgb('+math.multiply([1.0,0.2,0.0],255)+')';
      //------------------------------------
      } else if (ldata[i][2] == 4 && ICBMcheck == true){ //ICBM
      PlotValid = true;
      context.strokeStyle = 'rgb('+math.multiply([.75,0.0,.75],255)+')';
      //------------------------------------
      }
      if (ldata[i][7] == 0){
        context.setLineDash([3,3]);
      }else if (!isNaN(ldata[i][9]) && HypRangeCheck.checked == true){
        context.setLineDash([10,3]);
      }else{
        context.setLineDash([]);
      }
      if (PlotValid == true){
        context.stroke();
      }
      }
    }
    
  }
  
  function interpolateArray(data, fitCount) {

    var linearInterpolate = function (before, after, atPoint) {
        return before + (after - before) * atPoint;
    };

    var newData = new Array();
    var springFactor = new Number((data.length - 1) / (fitCount - 1));
    newData[0] = data[0]; // for new allocation
    for ( var i = 1; i < fitCount - 1; i++) {
        var tmp = i * springFactor;
        var before = new Number(Math.floor(tmp)).toFixed();
        var after = new Number(Math.ceil(tmp)).toFixed();
        var atPoint = tmp - before;
        newData[i] = linearInterpolate(data[before], data[after], atPoint);
    }
    newData[fitCount - 1] = data[data.length - 1]; // for new allocation
    return newData;
};
  
  </script>
  
  
</body>
</html>
